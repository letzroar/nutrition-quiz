<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nutrition & Lifestyle Assessment</title>

  <style>
    :root{
      --bg0:#070a10;
      --bg1:#0b1220;
      --text:#eaf2ff;
      --muted:#aab6cc;

      --protein:#fb7185;
      --carbs:#60a5fa;
      --fats:#34d399;

      --accent:#60a5fa;
      --danger:#fb7185;

      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 20px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 12% 0%, rgba(52,211,153,.18), transparent 60%),
        radial-gradient(1000px 700px at 88% 10%, rgba(96,165,250,.18), transparent 55%),
        radial-gradient(900px 700px at 65% 90%, rgba(251,113,133,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.22;
      background-image:
        radial-gradient(circle at 18px 18px, rgba(255,255,255,.06) 2px, transparent 2px),
        radial-gradient(circle at 58px 62px, rgba(255,255,255,.04) 2px, transparent 2px);
      background-size: 80px 80px;
      mix-blend-mode: overlay;
    }

    .wrap{ max-width: 1100px; margin:0 auto; padding: 26px 18px 60px; }
    .hero{ display:flex; flex-direction:column; gap:12px; margin-bottom: 14px; }
    .brandline{ display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap; justify-content:space-between; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,25,48,.55);
      box-shadow: 0 10px 28px rgba(0,0,0,.22);
      color: var(--muted); font-size: 13px;
    }
    .badge b{ color: var(--text); font-weight: 800; }
    h1{ font-size: 24px; margin:0; letter-spacing:.2px; }
    .sub{ margin:0; color:var(--muted); line-height:1.5; max-width: 76ch; }

    .card{
      background: linear-gradient(180deg, rgba(15,25,48,.92), rgba(10,16,32,.92));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(800px 400px at 10% 0%, rgba(52,211,153,.13), transparent 55%),
        radial-gradient(700px 350px at 90% 0%, rgba(96,165,250,.12), transparent 55%),
        rgba(15,25,48,.55);
    }
    .cardHeader p{ margin: 6px 0 0; color: var(--muted); font-size: 13px; line-height:1.45; }
    .cardBody{ padding: 16px; }

    .stepper{ display:flex; gap:8px; padding: 12px 16px 0; flex-wrap:wrap; }
    .dot{ width: 34px; height: 8px; border-radius:999px; background: rgba(255,255,255,.10); }
    .dot.on{ background: linear-gradient(90deg, rgba(52,211,153,.85), rgba(96,165,250,.85)); }

    h2{ font-size: 16px; margin: 18px 0 10px; color: rgba(96,165,250,.95); }
    #step-3 > h2{
      margin-top: 6px;
      margin-bottom: 12px;
      font-size: 18px;
      color: rgba(96,165,250,.95);
    }

    .note{ font-size: 12px; color: var(--muted); margin: 6px 0 0; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; }
    .field{ flex: 1 1 240px; display:flex; flex-direction:column; gap:6px; margin: 8px 0; }
    label{ font-size: 12px; color: var(--muted); }

    input, select, textarea{
      width:100%;
      background: rgba(9,14,28,.95);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 11px 12px;
      outline:none;
      transition: box-shadow .12s ease, border-color .12s ease;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(96,165,250,.55);
      box-shadow: 0 0 0 3px rgba(96,165,250,.15);
    }
    textarea{ min-height: 88px; resize: vertical; }

    .help{
      background: rgba(52,211,153,.07);
      border: 1px solid rgba(52,211,153,.15);
      padding: 10px 12px;
      border-radius: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }

    .checks{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
      background: rgba(9,14,28,.95);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 12px;
    }
    @media (min-width: 920px){
      .checks{ grid-template-columns: 1fr 1fr; }
    }
    .check{ display:flex; align-items:center; gap:10px; color: var(--muted); font-size: 13px; }
    .check input{ width: 16px; height: 16px; accent-color: #34d399; }

    .btnrow{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    button{
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 14px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight: 800;
      color: var(--text);
      background: rgba(255,255,255,.06);
      transition: transform .08s ease, filter .12s ease, box-shadow .12s ease;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; }

    .primary{
      border-color: rgba(52,211,153,.45);
      background: linear-gradient(90deg, rgba(52,211,153,.26), rgba(96,165,250,.22));
      box-shadow: 0 14px 30px rgba(52,211,153,.12);
    }
    .ghost{ border-color: rgba(255,255,255,.14); background: transparent; }
    .mini{ padding: 8px 12px; font-weight: 800; border-radius: 999px; }

    .invalid{
      border-color: rgba(251,113,133,.9) !important;
      box-shadow: 0 0 0 3px rgba(251,113,133,.18) !important;
    }
    .invalid-label{ color: rgba(251,113,133,.95) !important; }

    .errBanner{
      display:none;
      margin: 0 0 14px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(251,113,133,.25);
      background: rgba(251,113,133,.10);
      color: #ffe6ea;
      line-height: 1.45;
      font-size: 13px;
    }

    .warn{
      color: #ffe6ea;
      background: rgba(251,113,133,.10);
      border: 1px solid rgba(251,113,133,.25);
      padding: 12px 12px;
      border-radius: 14px;
      margin-bottom: 14px;
      line-height: 1.45;
      font-size: 13px;
    }

    .adjustNote{
      color: var(--muted);
      background: rgba(96,165,250,.08);
      border: 1px solid rgba(96,165,250,.25);
      padding: 12px 12px;
      border-radius: 14px;
      margin: 14px 0;
      line-height: 1.5;
      font-size: 13px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 920px){
      .grid2{ grid-template-columns: 1fr 1fr; }
      .span2{ grid-column: 1 / -1; }
    }

    .kpi{
      background: linear-gradient(180deg, rgba(9,14,28,.92), rgba(8,12,24,.92));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 12px;
    }
    .kpi .small{ color: var(--muted); font-size: 12px; }
    .kpi b{ display:block; font-size: 20px; margin-top: 6px; }
    .kpi.target{
      border-color: rgba(52,211,153,.40);
      background:
        radial-gradient(600px 240px at 10% 0%, rgba(52,211,153,.18), transparent 60%),
        linear-gradient(180deg, rgba(9,14,28,.92), rgba(8,12,24,.92));
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      border: 1px solid rgba(255,255,255,.12);
      padding: 7px 10px;
      border-radius: 999px;
      margin: 6px 6px 0 0;
      color: var(--muted);
      background: rgba(255,255,255,.04);
      font-size: 13px;
    }
    .pill b{ color: var(--text); }
    .pill.protein{ border-color: rgba(251,113,133,.45); background: rgba(251,113,133,.08); }
    .pill.protein b{ color: rgba(251,113,133,.98); }
    .pill.carbs{ border-color: rgba(96,165,250,.45); background: rgba(96,165,250,.08); }
    .pill.carbs b{ color: rgba(96,165,250,.98); }
    .pill.fats{ border-color: rgba(52,211,153,.45); background: rgba(52,211,153,.08); }
    .pill.fats b{ color: rgba(52,211,153,.98); }

    .list{ margin: 8px 0 0; padding-left: 18px; color: var(--muted); line-height: 1.6; }
    .hr{ height:1px; background: rgba(255,255,255,.08); margin: 14px 0; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; white-space: pre-wrap; word-break: break-word; }

    .drop{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.04);
    }
    .dropHead{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: 10px 12px;
      cursor:pointer;
      user-select:none;
      color: var(--text);
      font-weight: 900;
    }
    .dropBody{
      display:none;
      padding: 10px 12px 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .drop.open .dropBody{ display:block; }

    .mealsBox{
      border: 1px solid rgba(96,165,250,.25);
      background: radial-gradient(900px 380px at 15% 0%, rgba(96,165,250,.12), transparent 60%),
                  radial-gradient(900px 380px at 85% 0%, rgba(52,211,153,.10), transparent 60%),
                  rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 12px;
    }
    .mealsTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 950;
      color: rgba(96,165,250,.98);
      margin: 0 0 8px;
    }
    .mealsTitle span{
      display:inline-flex;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(96,165,250,.35);
      background: rgba(96,165,250,.10);
      color: rgba(96,165,250,.98);
      font-size: 12px;
      font-weight: 900;
    }

    .donutRow{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .donutCard{
      flex: 1 1 320px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.03);
      min-height: 160px;
    }
    .donutHead{
      display:flex;
      align-items:baseline;
      justify-content: space-between;
      gap: 12px;
    }
    .donutHead b{ font-size: 13px; color: var(--text); }
    .donutHead span{ font-size: 12px; color: var(--muted); }
    .donutWrap{
      display:flex;
      align-items:center;
      gap: 12px;
      margin-top: 10px;
    }
    .legend{
      display:flex;
      flex-direction:column;
      gap: 8px;
      font-size: 12px;
      color: var(--muted);
      min-width: 220px;
    }
    .legItem{ display:flex; align-items:center; gap: 8px; }
    .swatch{ width: 10px; height: 10px; border-radius: 3px; }
    .swProtein{ background: var(--protein); }
    .swCarbs{ background: var(--carbs); }
    .swFats{ background: var(--fats); }

    #heroBadges {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .bfGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 600px){
      .bfGrid{ grid-template-columns: 1fr; }
    }

    .bfCard{
      text-align:left;
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 300px at 20% 0%, rgba(96,165,250,.12), transparent 60%),
        rgba(9,14,28,.92);
      color: var(--text);
      cursor:pointer;
      transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease, filter .12s ease;
    }
    .bfCard:hover{ filter: brightness(1.05); }
    .bfCard:active{ transform: translateY(1px); }

    .bfImgWrap{
      width:100%;
      aspect-ratio: 16/10;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .bfImgWrap img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .bfTop{
      display:flex;
      align-items:baseline;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
    }
    .bfTitle{ font-weight: 950; letter-spacing:.2px; }
    .bfTag{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 999px;
      padding: 6px 10px;
      white-space: nowrap;
    }
    .bfDesc{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .bfCard.isSelected{
      border-color: rgba(52,211,153,.55);
      box-shadow: 0 0 0 3px rgba(52,211,153,.14), 0 18px 45px rgba(0,0,0,.25);
      background:
        radial-gradient(900px 300px at 20% 0%, rgba(52,211,153,.16), transparent 60%),
        radial-gradient(800px 260px at 90% 0%, rgba(96,165,250,.10), transparent 55%),
        rgba(9,14,28,.92);
    }

    .bfCard.isHidden{ display:none; }

    .bfGrid.invalidGrid{
      border-radius: 16px;
      box-shadow: 0 0 0 3px rgba(251,113,133,.18);
      padding: 6px;
    }

    .bfPrompt{
      padding: 20px;
      text-align: center;
      color: var(--muted);
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
    }

    .ctaBox{
      border: 1px solid rgba(96,165,250,.35);
      background:
        radial-gradient(900px 380px at 15% 0%, rgba(96,165,250,.15), transparent 60%),
        radial-gradient(900px 380px at 85% 0%, rgba(52,211,153,.12), transparent 60%),
        rgba(15,25,48,.85);
      border-radius: 16px;
      padding: 18px;
      margin: 16px 0;
    }
    .ctaItem{
      margin-bottom: 16px;
    }
    .ctaItem:last-child{
      margin-bottom: 0;
    }
    .ctaTitle{
      font-weight: 800;
      color: var(--text);
      margin-bottom: 8px;
      font-size: 14px;
      line-height: 1.45;
    }
    .ctaDesc{
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 10px;
      line-height: 1.45;
    }
    .ctaBtn{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 14px;
      text-decoration: none;
      transition: transform .08s ease, filter .12s ease, box-shadow .12s ease;
      cursor: pointer;
    }
    .ctaBtn:hover{
      filter: brightness(1.08);
      transform: translateY(-1px);
    }
    .ctaBtn:active{
      transform: translateY(1px);
    }
    .ctaBtn.ctaPrimary{
      background: linear-gradient(90deg, rgba(52,211,153,.85), rgba(96,165,250,.85));
      color: #fff;
      border: none;
      box-shadow: 0 8px 24px rgba(52,211,153,.25);
    }
    .ctaBtn.ctaSecondary{
      background: rgba(255,255,255,.08);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.18);
    }
    .ctaDivider{
      height: 1px;
      background: rgba(255,255,255,.10);
      margin: 14px 0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="brandline" style="justify-content:space-between; align-items:flex-start;">
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;"></div>
        <div class="field" style="flex:0 0 auto; margin:0; min-width:170px;">
          <label for="langSelect" style="margin-bottom:6px;" data-i18n="lang.label">Language</label>
          <select id="langSelect" style="padding:10px 12px;">
            <option value="en">English</option>
            <option value="fr">FranÃ§ais</option>
            <option value="de">Deutsch</option>
          </select>
        </div>
      </div>

      <div id="heroBadges">
        <span class="badge" data-i18n="badge.quiz">ðŸ¥— <b>Nutrition Quiz</b> â€” calories, macros, and a 2-week plan</span>
        <span class="badge" data-i18n="badge.simple">âš¡ <b>Simple</b> â€” made to be easy</span>
        <span class="badge" data-i18n="badge.private">ðŸ”’ <b>Private</b> â€” runs in your browser</span>
      </div>

      <h1 data-i18n="hero.title">Nutrition & Lifestyle Assessment</h1>
      <p class="sub" data-i18n="hero.sub">
        Answer a few questions to estimate calories and macros, then get food options, swaps, steps + training targets, and a simple 2-week plan.
      </p>
    </div>

    <div class="card">
      <div class="cardHeader">
        <p data-i18n="notice.top"></p>
      </div>

      <div class="stepper" id="stepper"></div>

      <div class="cardBody">
        <div class="errBanner" id="errBanner"></div>

        <form id="quizForm" novalidate>

          <!-- STEP 0 -->
          <div id="step-0" class="step">
            <h2 data-i18n="s1.title">1) Personal Data</h2>

            <div class="row">
              <div class="field">
                <label for="firstName" data-i18n="p.name">Name</label>
                <input id="firstName" type="text" name="firstName" required data-i18n-placeholder="p.name_ph" placeholder="e.g., Sarah" />
              </div>
              <div class="field">
                <label for="userEmail" data-i18n="p.email">Email</label>
                <input id="userEmail" type="email" name="userEmail" required data-i18n-placeholder="p.email_ph" placeholder="name@email.com" />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="age" data-i18n="s1.age">Age (years)</label>
                <input id="age" type="number" min="13" max="90" name="age" required />
              </div>
              <div class="field">
                <label for="gender" data-i18n="s1.gender">Gender</label>
                <select id="gender" name="gender" required>
                  <option value="" data-i18n="s1.gender.select">Select</option>
                  <option value="male" data-i18n="s1.gender.male">Male</option>
                  <option value="female" data-i18n="s1.gender.female">Female</option>
                </select>
              </div>
              <div class="field">
                <label for="country" data-i18n="p.country">Country</label>
                <select id="country" name="country" required>
                  <option value="" data-i18n="p.country.select">Select</option>
                  <option value="AF">Afghanistan</option>
                  <option value="AL">Albania</option>
                  <option value="DZ">Algeria</option>
                  <option value="AD">Andorra</option>
                  <option value="AO">Angola</option>
                  <option value="AG">Antigua and Barbuda</option>
                  <option value="AR">Argentina</option>
                  <option value="AM">Armenia</option>
                  <option value="AU">Australia</option>
                  <option value="AT">Austria</option>
                  <option value="AZ">Azerbaijan</option>
                  <option value="BS">Bahamas</option>
                  <option value="BH">Bahrain</option>
                  <option value="BD">Bangladesh</option>
                  <option value="BB">Barbados</option>
                  <option value="BY">Belarus</option>
                  <option value="BE">Belgium</option>
                  <option value="BZ">Belize</option>
                  <option value="BJ">Benin</option>
                  <option value="BT">Bhutan</option>
                  <option value="BO">Bolivia</option>
                  <option value="BA">Bosnia and Herzegovina</option>
                  <option value="BW">Botswana</option>
                  <option value="BR">Brazil</option>
                  <option value="BN">Brunei</option>
                  <option value="BG">Bulgaria</option>
                  <option value="BF">Burkina Faso</option>
                  <option value="BI">Burundi</option>
                  <option value="CV">Cabo Verde</option>
                  <option value="KH">Cambodia</option>
                  <option value="CM">Cameroon</option>
                  <option value="CA">Canada</option>
                  <option value="CF">Central African Republic</option>
                  <option value="TD">Chad</option>
                  <option value="CL">Chile</option>
                  <option value="CN">China</option>
                  <option value="CO">Colombia</option>
                  <option value="KM">Comoros</option>
                  <option value="CG">Congo</option>
                  <option value="CD">Congo (DRC)</option>
                  <option value="CR">Costa Rica</option>
                  <option value="CI">CÃ´te d'Ivoire</option>
                  <option value="HR">Croatia</option>
                  <option value="CU">Cuba</option>
                  <option value="CY">Cyprus</option>
                  <option value="CZ">Czech Republic</option>
                  <option value="DK">Denmark</option>
                  <option value="DJ">Djibouti</option>
                  <option value="DM">Dominica</option>
                  <option value="DO">Dominican Republic</option>
                  <option value="EC">Ecuador</option>
                  <option value="EG">Egypt</option>
                  <option value="SV">El Salvador</option>
                  <option value="GQ">Equatorial Guinea</option>
                  <option value="ER">Eritrea</option>
                  <option value="EE">Estonia</option>
                  <option value="SZ">Eswatini</option>
                  <option value="ET">Ethiopia</option>
                  <option value="FJ">Fiji</option>
                  <option value="FI">Finland</option>
                  <option value="FR">France</option>
                  <option value="GA">Gabon</option>
                  <option value="GM">Gambia</option>
                  <option value="GE">Georgia</option>
                  <option value="DE">Germany</option>
                  <option value="GH">Ghana</option>
                  <option value="GR">Greece</option>
                  <option value="GD">Grenada</option>
                  <option value="GT">Guatemala</option>
                  <option value="GN">Guinea</option>
                  <option value="GW">Guinea-Bissau</option>
                  <option value="GY">Guyana</option>
                  <option value="HT">Haiti</option>
                  <option value="HN">Honduras</option>
                  <option value="HU">Hungary</option>
                  <option value="IS">Iceland</option>
                  <option value="IN">India</option>
                  <option value="ID">Indonesia</option>
                  <option value="IR">Iran</option>
                  <option value="IQ">Iraq</option>
                  <option value="IE">Ireland</option>
                  <option value="IL">Israel</option>
                  <option value="IT">Italy</option>
                  <option value="JM">Jamaica</option>
                  <option value="JP">Japan</option>
                  <option value="JO">Jordan</option>
                  <option value="KZ">Kazakhstan</option>
                  <option value="KE">Kenya</option>
                  <option value="KI">Kiribati</option>
                  <option value="KP">Korea (North)</option>
                  <option value="KR">Korea (South)</option>
                  <option value="KW">Kuwait</option>
                  <option value="KG">Kyrgyzstan</option>
                  <option value="LA">Laos</option>
                  <option value="LV">Latvia</option>
                  <option value="LB">Lebanon</option>
                  <option value="LS">Lesotho</option>
                  <option value="LR">Liberia</option>
                  <option value="LY">Libya</option>
                  <option value="LI">Liechtenstein</option>
                  <option value="LT">Lithuania</option>
                  <option value="LU">Luxembourg</option>
                  <option value="MG">Madagascar</option>
                  <option value="MW">Malawi</option>
                  <option value="MY">Malaysia</option>
                  <option value="MV">Maldives</option>
                  <option value="ML">Mali</option>
                  <option value="MT">Malta</option>
                  <option value="MH">Marshall Islands</option>
                  <option value="MR">Mauritania</option>
                  <option value="MU">Mauritius</option>
                  <option value="MX">Mexico</option>
                  <option value="FM">Micronesia</option>
                  <option value="MD">Moldova</option>
                  <option value="MC">Monaco</option>
                  <option value="MN">Mongolia</option>
                  <option value="ME">Montenegro</option>
                  <option value="MA">Morocco</option>
                  <option value="MZ">Mozambique</option>
                  <option value="MM">Myanmar</option>
                  <option value="NA">Namibia</option>
                  <option value="NR">Nauru</option>
                  <option value="NP">Nepal</option>
                  <option value="NL">Netherlands</option>
                  <option value="NZ">New Zealand</option>
                  <option value="NI">Nicaragua</option>
                  <option value="NE">Niger</option>
                  <option value="NG">Nigeria</option>
                  <option value="MK">North Macedonia</option>
                  <option value="NO">Norway</option>
                  <option value="OM">Oman</option>
                  <option value="PK">Pakistan</option>
                  <option value="PW">Palau</option>
                  <option value="PS">Palestine</option>
                  <option value="PA">Panama</option>
                  <option value="PG">Papua New Guinea</option>
                  <option value="PY">Paraguay</option>
                  <option value="PE">Peru</option>
                  <option value="PH">Philippines</option>
                  <option value="PL">Poland</option>
                  <option value="PT">Portugal</option>
                  <option value="QA">Qatar</option>
                  <option value="RO">Romania</option>
                  <option value="RU">Russia</option>
                  <option value="RW">Rwanda</option>
                  <option value="KN">Saint Kitts and Nevis</option>
                  <option value="LC">Saint Lucia</option>
                  <option value="VC">Saint Vincent</option>
                  <option value="WS">Samoa</option>
                  <option value="SM">San Marino</option>
                  <option value="ST">SÃ£o TomÃ© and PrÃ­ncipe</option>
                  <option value="SA">Saudi Arabia</option>
                  <option value="SN">Senegal</option>
                  <option value="RS">Serbia</option>
                  <option value="SC">Seychelles</option>
                  <option value="SL">Sierra Leone</option>
                  <option value="SG">Singapore</option>
                  <option value="SK">Slovakia</option>
                  <option value="SI">Slovenia</option>
                  <option value="SB">Solomon Islands</option>
                  <option value="SO">Somalia</option>
                  <option value="ZA">South Africa</option>
                  <option value="SS">South Sudan</option>
                  <option value="ES">Spain</option>
                  <option value="LK">Sri Lanka</option>
                  <option value="SD">Sudan</option>
                  <option value="SR">Suriname</option>
                  <option value="SE">Sweden</option>
                  <option value="CH">Switzerland</option>
                  <option value="SY">Syria</option>
                  <option value="TW">Taiwan</option>
                  <option value="TJ">Tajikistan</option>
                  <option value="TZ">Tanzania</option>
                  <option value="TH">Thailand</option>
                  <option value="TL">Timor-Leste</option>
                  <option value="TG">Togo</option>
                  <option value="TO">Tonga</option>
                  <option value="TT">Trinidad and Tobago</option>
                  <option value="TN">Tunisia</option>
                  <option value="TR">Turkey</option>
                  <option value="TM">Turkmenistan</option>
                  <option value="TV">Tuvalu</option>
                  <option value="UG">Uganda</option>
                  <option value="UA">Ukraine</option>
                  <option value="AE">United Arab Emirates</option>
                  <option value="GB">United Kingdom</option>
                  <option value="US">United States</option>
                  <option value="UY">Uruguay</option>
                  <option value="UZ">Uzbekistan</option>
                  <option value="VU">Vanuatu</option>
                  <option value="VA">Vatican City</option>
                  <option value="VE">Venezuela</option>
                  <option value="VN">Vietnam</option>
                  <option value="YE">Yemen</option>
                  <option value="ZM">Zambia</option>
                  <option value="ZW">Zimbabwe</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="heightCm" data-i18n="s1.height">Height (cm)</label>
                <input id="heightCm" type="number" min="120" max="230" name="heightCm" required />
              </div>
              <div class="field">
                <label for="weightKg" data-i18n="s1.weight">Weight (kg)</label>
                <input id="weightKg" type="number" min="35" max="250" step="0.1" name="weightKg" required />
              </div>
              <div class="field">
                <label for="activity" data-i18n="s1.activity">Activity level (lifestyle + training)</label>
                <select id="activity" name="activity" required>
                  <option value="" data-i18n="s1.activity.select">Select</option>
                  <option value="sedentary" data-i18n="s1.activity.sedentary">Sedentary</option>
                  <option value="light" data-i18n="s1.activity.light">Lightly active</option>
                  <option value="moderate" data-i18n="s1.activity.moderate">Moderately active</option>
                  <option value="very" data-i18n="s1.activity.very">Very active</option>
                </select>
                <div class="help" data-i18n="s1.activity.help">
                  <b>Examples:</b><br/>
                  <b>Sedentary:</b> desk job, little walking, no/rare training.<br/>
                  <b>Light:</b> desk job + regular walks, training 1â€“3Ã—/week.<br/>
                  <b>Moderate:</b> active days + training 3â€“5Ã—/week (or lots of walking).<br/>
                  <b>Very active:</b> physical job OR high movement + frequent training.
                </div>
              </div>
            </div>

            <!-- BODY FAT VISUAL SELECTOR -->
            <div class="field" id="bfFieldWrap">
              <label data-i18n="s1.bfVisual.label">Body fat estimate (visual)</label>

              <input type="hidden" id="bfMin" name="bfMin" required />
              <input type="hidden" id="bfMax" name="bfMax" required />
              <input type="hidden" id="bfRangeLabel" name="bfRangeLabel" required />

              <div class="bfPrompt" id="bfPrompt" data-i18n="s1.bfVisual.selectGender">
                Please select your gender first to see body fat options.
              </div>

              <div class="bfGrid" id="bfGrid" role="radiogroup" aria-label="Body fat visual estimate" style="display:none;">

                <!-- MALE CARDS -->
                <button type="button" class="bfCard" data-gender="male" data-min="1" data-max="7" data-label="1â€“7%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_1_7.png" alt="Male 1â€“7% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">1â€“7%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.1_7.desc">Competition level. Extremely striated, veins everywhere.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="8" data-max="10" data-label="8â€“10%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_8_10.png" alt="Male 8â€“10% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">8â€“10%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.8_10.desc">Very lean. Clear striations, visible veins.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="11" data-max="12" data-label="11â€“12%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_11_12.png" alt="Male 11â€“12% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">11â€“12%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.11_12.desc">Lean. Clear abs, some vascularity.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="13" data-max="15" data-label="13â€“15%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_13_15.png" alt="Male 13â€“15% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">13â€“15%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.13_15.desc">Athletic. Visible abs, defined muscles.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="16" data-max="19" data-label="16â€“19%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_16_19.png" alt="Male 16â€“19% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">16â€“19%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.16_19.desc">Fit. Some ab definition, less separation.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="20" data-max="24" data-label="20â€“24%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_20_24.png" alt="Male 20â€“24% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">20â€“24%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.20_24.desc">Average. Little ab definition, softer look.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="25" data-max="30" data-label="25â€“30%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_25_30.png" alt="Male 25â€“30% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">25â€“30%</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.25_30.desc">Soft midsection. Noticeable fat around waist.</div>
                </button>

                <button type="button" class="bfCard" data-gender="male" data-min="35" data-max="40" data-label="35â€“40%+" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/male_35_40.png" alt="Male 35â€“40%+ body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">35â€“40%+</div>
                    <div class="bfTag" data-i18n="s1.gender.male">Male</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.male.35_40.desc">Clear fat accumulation. Rounder midsection.</div>
                </button>

                <!-- FEMALE CARDS -->
                <button type="button" class="bfCard" data-gender="female" data-min="10" data-max="12" data-label="10â€“12%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_10_12.png" alt="Female 10â€“12% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">10â€“12%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.10_12.desc">Competition level. Extremely defined, visible striations.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="15" data-max="17" data-label="15â€“17%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_15_17.png" alt="Female 15â€“17% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">15â€“17%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.15_17.desc">Very lean. Clear muscle definition, visible abs.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="18" data-max="20" data-label="18â€“20%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_18_20.png" alt="Female 18â€“20% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">18â€“20%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.18_20.desc">Athletic/fit. Some ab definition, toned look.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="21" data-max="23" data-label="21â€“23%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_21_23.png" alt="Female 21â€“23% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">21â€“23%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.21_23.desc">Fit. Less definition, still lean.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="24" data-max="26" data-label="24â€“26%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_24_26.png" alt="Female 24â€“26% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">24â€“26%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.24_26.desc">Average/healthy. Some softness, normal look.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="27" data-max="29" data-label="27â€“29%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_27_29.png" alt="Female 27â€“29% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">27â€“29%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.27_29.desc">Softer shape. More fat around hips/waist.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="30" data-max="35" data-label="30â€“35%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_30_35.png" alt="Female 30â€“35% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">30â€“35%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.30_35.desc">Clear fat accumulation around body.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="36" data-max="40" data-label="36â€“40%" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_36_40.png" alt="Female 36â€“40% body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">36â€“40%</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.36_40.desc">Significant fat. Larger overall appearance.</div>
                </button>

                <button type="button" class="bfCard" data-gender="female" data-min="50" data-max="55" data-label="50%+" role="radio" aria-checked="false">
                  <div class="bfImgWrap"><img src="img/bf/female_50_plus.png" alt="Female 50%+ body fat visual" /></div>
                  <div class="bfTop">
                    <div class="bfTitle">50%+</div>
                    <div class="bfTag" data-i18n="s1.gender.female">Female</div>
                  </div>
                  <div class="bfDesc" data-i18n="s1.bf.female.50_plus.desc">High body fat. Much larger frame.</div>
                </button>

              </div>

              <div class="help" data-i18n="s1.bfVisual.help">
                Choose the closest match. If you're between two, pick the higher range.
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="experience" data-i18n="s1.experience">Training experience</label>
                <select id="experience" name="experience" required>
                  <option value="" data-i18n="s1.experience.select">Select</option>
                  <option value="none" data-i18n="s1.experience.none">None</option>
                  <option value="beginner" data-i18n="s1.experience.beginner">Beginner (0â€“2 yrs)</option>
                                <option value="intermediate" data-i18n="s1.experience.intermediate">Intermediate (2â€“5 yrs)</option>
                  <option value="advanced" data-i18n="s1.experience.advanced">Advanced (5+ yrs)</option>
                </select>
              </div>

              <div class="field">
                <label for="trainingNow" data-i18n="s1.trainingNow">Currently training?</label>
                <select id="trainingNow" name="trainingNow" required>
                  <option value="" data-i18n="s1.trainingNow.select">Select</option>
                  <option value="no" data-i18n="s1.no">No</option>
                  <option value="yes" data-i18n="s1.yes">Yes</option>
                </select>
              </div>

              <div class="field" id="trainedBeforeWrap" style="display:none">
                <label for="trainedBefore" data-i18n="s1.trainedBefore">If no: have you trained before?</label>
                <select id="trainedBefore" name="trainedBefore">
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="no" data-i18n="common.no">No</option>
                  <option value="yes" data-i18n="common.yes">Yes</option>
                </select>
              </div>

              <div class="field" id="trainingTypeWrap" style="display:none">
                <label for="trainingType" data-i18n="s1.trainingType">Training type</label>
                <select id="trainingType" name="trainingType">
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="strength" data-i18n="s1.trainingType.strength">Strength / weights</option>
                  <option value="cardio" data-i18n="s1.trainingType.cardio">Cardio / endurance</option>
                  <option value="mixed" data-i18n="s1.trainingType.mixed">Mixed</option>
                  <option value="sport" data-i18n="s1.trainingType.sport">Sport-specific</option>
                </select>
              </div>

              <div class="field" id="trainingDetailsWrap" style="display:none">
                <label for="trainingDetails" data-i18n="s1.trainingDetails">What exactly do you do?</label>
                <input id="trainingDetails" name="trainingDetails" type="text" data-i18n-placeholder="s1.trainingDetails.ph" placeholder="e.g., football + gym, CrossFit, boxing..." />
              </div>

              <div class="field" id="sessionsWrap">
                <label for="sessionsPerWeek" data-i18n="s1.sessions">Sessions per week</label>
                <select id="sessionsPerWeek" name="sessionsPerWeek">
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="0">0</option>
                  <option value="1-2">1â€“2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5-6">5â€“6</option>
                  <option value="7">7+</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="steps" data-i18n="s1.steps">Average daily steps</label>
                <select id="steps" name="steps" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="none" data-i18n="s1.steps.none">I don't track / very low</option>
                  <option value="2k" data-i18n="s1.steps.2k">~2,000/day</option>
                  <option value="lt4k" data-i18n="s1.steps.lt4k">&lt; 4,000/day</option>
                  <option value="4to8k" data-i18n="s1.steps.4to8k">4,000â€“8,000/day</option>
                  <option value="8to12k" data-i18n="s1.steps.8to12k">8,000â€“12,000/day</option>
                  <option value="gt12k" data-i18n="s1.steps.gt12k">&gt; 12,000/day</option>
                </select>
              </div>

              <div class="field">
                <label for="sleep" data-i18n="s1.sleep">Sleep per night</label>
                <select id="sleep" name="sleep" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="lt4" data-i18n="s1.sleep.lt4">&lt; 4h</option>
                  <option value="4to6" data-i18n="s1.sleep.4to6">4â€“6h</option>
                  <option value="6to8" data-i18n="s1.sleep.6to8">6â€“8h</option>
                  <option value="8plus" data-i18n="s1.sleep.8plus">8h+</option>
                </select>
              </div>

              <div class="field">
                <label for="goal" data-i18n="s1.goal">Goal</label>
                <select id="goal" name="goal" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="lose" data-i18n="s1.goal.lose">Lose fat</option>
                  <option value="maintain" data-i18n="s1.goal.maintain">Recomposition (Lose fat / build muscle)</option>
                  <option value="gain" data-i18n="s1.goal.gain">Build lean muscle mass</option>
                </select>
              </div>
            </div>
          </div>

          <!-- STEP 1 -->
          <div id="step-1" class="step" style="display:none">
            <h2 data-i18n="s2.title">2) Nutrition & Eating Habits</h2>
            <p class="note" data-i18n="s2.note">Choose what best matches your average week.</p>

            <div class="row">
              <div class="field">
                <label for="snacks" data-i18n="s2.snacks">Sugary snacks</label>
                <select id="snacks" name="snacks" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="none" data-i18n="common.none">None</option>
                  <option value="1" data-i18n="freq.1w">1Ã—/week</option>
                  <option value="2" data-i18n="freq.2w">2Ã—/week</option>
                  <option value="3-5" data-i18n="freq.3_5w">3â€“5Ã—/week</option>
                  <option value="daily" data-i18n="freq.daily">Daily</option>
                </select>
              </div>

              <div class="field">
                <label for="sodas" data-i18n="s2.sodas">Sodas / sweetened drinks</label>
                <select id="sodas" name="sodas" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="none" data-i18n="common.none">None</option>
                  <option value="1" data-i18n="freq.1w">1Ã—/week</option>
                  <option value="2" data-i18n="freq.2w">2Ã—/week</option>
                  <option value="3-5" data-i18n="freq.3_5w">3â€“5Ã—/week</option>
                  <option value="daily" data-i18n="freq.daily">Daily</option>
                </select>
              </div>

              <div class="field">
                <label for="fastfood" data-i18n="s2.fastfood">Fast food / burgers</label>
                <select id="fastfood" name="fastfood" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="none" data-i18n="common.none">None</option>
                  <option value="1" data-i18n="freq.1w">1Ã—/week</option>
                  <option value="2" data-i18n="freq.2w">2Ã—/week</option>
                  <option value="3-5" data-i18n="freq.3_5w">3â€“5Ã—/week</option>
                  <option value="daily" data-i18n="freq.daily">Daily</option>
                </select>
              </div>

              <div class="field">
                <label for="alcohol" data-i18n="s2.alcohol">Alcohol (frequency)</label>
                <select id="alcohol" name="alcohol" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="none" data-i18n="common.none">None</option>
                  <option value="1" data-i18n="freq.1w">1Ã—/week</option>
                  <option value="2" data-i18n="freq.2w">2Ã—/week</option>
                  <option value="3-4" data-i18n="freq.3_4w">3â€“4Ã—/week</option>
                  <option value="5+" data-i18n="freq.5w">5+Ã—/week</option>
                  <option value="daily" data-i18n="freq.daily">Daily</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="tracks" data-i18n="s2.tracks">Do you track calories currently?</label>
                <select id="tracks" name="tracks" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="no" data-i18n="common.no">No</option>
                  <option value="sometimes" data-i18n="common.sometimes">Sometimes</option>
                  <option value="yes" data-i18n="common.yes">Yes</option>
                </select>
              </div>

              <div class="field">
                <label for="currentCals" data-i18n="s2.currentCals">If you had to guess: current daily calories (optional)</label>
                <input id="currentCals" type="number" min="800" max="6000" name="currentCals" data-i18n-placeholder="s2.currentCals.ph" placeholder="e.g., 2200" />
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div id="step-2" class="step" style="display:none">
            <h2 data-i18n="s3.title">3) Dietary Preferences & Constraints</h2>

            <div class="row">
              <div class="field">
                <label for="diet" data-i18n="s3.diet">Diet type</label>
                <select id="diet" name="diet" required>
                  <option value="" data-i18n="common.select">Select</option>
                  <option value="omnivore" data-i18n="s3.diet.omnivore">Omnivore</option>
                  <option value="vegetarian" data-i18n="s3.diet.vegetarian">Vegetarian</option>
                  <option value="vegan" data-i18n="s3.diet.vegan">Vegan</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label data-i18n="s3.allergies">Allergies / restrictions (select all that apply)</label>
              <div class="checks">
                <label class="check"><input type="checkbox" name="allergies" value="milk"><span data-i18n="s3.allergy.milk">Milk (Dairy)</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="egg"><span data-i18n="s3.allergy.egg">Egg</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="peanut"><span data-i18n="s3.allergy.peanut">Peanut</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="treenuts"><span data-i18n="s3.allergy.treenuts">Tree nuts</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="soy"><span data-i18n="s3.allergy.soy">Soy</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="wheat"><span data-i18n="s3.allergy.wheat">Wheat</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="gluten"><span data-i18n="s3.allergy.gluten">Gluten</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="fish"><span data-i18n="s3.allergy.fish">Fish</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="shellfish"><span data-i18n="s3.allergy.shellfish">Shellfish</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="sesame"><span data-i18n="s3.allergy.sesame">Sesame</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="corn"><span data-i18n="s3.allergy.corn">Corn</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="mustard"><span data-i18n="s3.allergy.mustard">Mustard</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="celery"><span data-i18n="s3.allergy.celery">Celery</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="lupin"><span data-i18n="s3.allergy.lupin">Lupin</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="sulfites"><span data-i18n="s3.allergy.sulfites">Sulfites</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="fruits"><span data-i18n="s3.allergy.fruits">Fruits</span></label>
                <label class="check"><input type="checkbox" name="allergies" value="vegetables"><span data-i18n="s3.allergy.vegetables">Vegetables</span></label>
              </div>
            </div>

            <div class="row">
              <div class="field" id="produceAllergyWrap" style="display:none">
                <label for="produceAllergyDetails" data-i18n="s3.produce.details">If you're allergic to fruits and/or vegetables, what exactly?</label>
                <input id="produceAllergyDetails" name="produceAllergyDetails" type="text" data-i18n-placeholder="s3.produce.details.ph" placeholder="e.g., strawberries, apples / tomatoes / peppers..." />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="likes" data-i18n="s3.likes">Favourite foods (comma separated)</label>
                <textarea id="likes" name="likes" data-i18n-placeholder="s3.likes.ph" placeholder="e.g., pasta, curry, wraps, oats"></textarea>
              </div>
              <div class="field">
                <label for="dislikes" data-i18n="s3.dislikes">Foods you dislike / avoid (comma separated)</label>
                <textarea id="dislikes" name="dislikes" data-i18n-placeholder="s3.dislikes.ph" placeholder="e.g., mushrooms, tuna, eggs, rice"></textarea>
              </div>
            </div>
          </div>

          <!-- STEP 3 -->
          <div id="step-3" class="step" style="display:none">
            <h2 data-i18n="results.title">Your Results</h2>
            <div id="results"></div>
          </div>

          <div class="btnrow">
            <button type="button" class="ghost" id="backBtn" disabled data-i18n="btn.back">Back</button>
            <button type="button" class="primary" id="nextBtn" data-i18n="btn.next">Next</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
/* =========================
   GOOGLE SHEETS TRACKING
   ========================= */
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwai0sBu1k667wOjjUMQre6CY5wQdAWXwkSQuncb5daRrto-HXiXRGaydUIaeyPTbxh/exec';

function generateSessionId() {
  return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

let sessionId = sessionStorage.getItem('quiz_session_id');
if (!sessionId) {
  sessionId = generateSessionId();
  sessionStorage.setItem('quiz_session_id', sessionId);
}

let userContactInfo = { email: '', phone: '' };

let ctaClicks = {
  calendly: false, skool: false, sendEmail: false,
  sendWhatsApp: false, sendResultsChecked: false
};

function trackToGoogleSheets(status, stepReached, additionalData = {}) {
  const formData = getFormDataForTracking();
  const trackingData = {
    sessionId, status, stepReached,
    language: getLang(), userAgent: navigator.userAgent,
    contactEmail: userContactInfo.email, contactPhone: userContactInfo.phone,
    clickedCalendly: ctaClicks.calendly, clickedSkool: ctaClicks.skool,
    clickedSendEmail: ctaClicks.sendEmail, clickedSendWhatsApp: ctaClicks.sendWhatsApp,
    wantsResults: ctaClicks.sendResultsChecked,
    ...formData, ...additionalData
  };
  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST', mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(trackingData)
  }).catch(err => { console.log('Tracking error (non-blocking):', err); });
}

function trackCtaClick(ctaType) {
  ctaClicks[ctaType] = true;
  trackToGoogleSheets('cta_click', currentStep, { ctaClicked: ctaType, ctaClickTime: new Date().toISOString() });
}

function trackContactInfo(type, value) {
  if (type === 'email') userContactInfo.email = value;
  else if (type === 'phone') userContactInfo.phone = value;
  trackToGoogleSheets('contact_info_entered', currentStep, { contactType: type, contactValue: value });
}

function getFormDataForTracking() {
  const form = document.getElementById('quizForm');
  const fd = new FormData(form);
  const allergies = fd.getAll('allergies');
  const data = Object.fromEntries(fd.entries());
  data.allergies = allergies;
  return {
    firstName: data.firstName || '', userEmail: data.userEmail || '',
    country: data.country || '', age: data.age || '',
    gender: data.gender || '', heightCm: data.heightCm || '',
    weightKg: data.weightKg || '', bfRangeLabel: data.bfRangeLabel || '',
    activity: data.activity || '', experience: data.experience || '',
    trainingNow: data.trainingNow || '', trainedBefore: data.trainedBefore || '',
    trainingType: data.trainingType || '', trainingDetails: data.trainingDetails || '',
    sessionsPerWeek: data.sessionsPerWeek || '', steps: data.steps || '',
    sleep: data.sleep || '', goal: data.goal || '',
    snacks: data.snacks || '', sodas: data.sodas || '',
    fastfood: data.fastfood || '', alcohol: data.alcohol || '',
    tracks: data.tracks || '', currentCals: data.currentCals || '',
    diet: data.diet || '', allergies: allergies,
    likes: data.likes || '', dislikes: data.dislikes || ''
  };
}

window.addEventListener('load', () => { setTimeout(() => { trackToGoogleSheets('started', 0); }, 1000); });

window.addEventListener('beforeunload', () => {
  const data = {
    sessionId, status: currentStep === stepsEls.length - 1 ? 'completed' : 'abandoned',
    stepReached: currentStep, language: getLang(), userAgent: navigator.userAgent,
    contactEmail: userContactInfo.email, contactPhone: userContactInfo.phone,
    clickedCalendly: ctaClicks.calendly, clickedSkool: ctaClicks.skool,
    clickedSendEmail: ctaClicks.sendEmail, clickedSendWhatsApp: ctaClicks.sendWhatsApp,
    wantsResults: ctaClicks.sendResultsChecked, ...getFormDataForTracking()
  };
  if (navigator.sendBeacon) navigator.sendBeacon(GOOGLE_SCRIPT_URL, JSON.stringify(data));
});

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => { clearTimeout(timeout); func(...args); };
    clearTimeout(timeout); timeout = setTimeout(later, wait);
  };
}

const trackFieldChange = debounce(() => { trackToGoogleSheets('in_progress', currentStep); }, 2000);

document.querySelectorAll('#quizForm input, #quizForm select, #quizForm textarea').forEach(field => {
  field.addEventListener('change', trackFieldChange);
  field.addEventListener('input', trackFieldChange);
});

/* =========================
   I18N (EN / FR / DE)
   ========================= */
const I18N = {
  en: {
    "lang.label": "Language",
    "badge.quiz": "ðŸ¥— <b>Nutrition Quiz</b> â€” calories, macros, and a 2-week plan",
    "badge.simple": "âš¡ <b>Simple</b> â€” made to be easy",
    "badge.private": "ðŸ”’ <b>Private</b> â€” runs in your browser",
    "hero.title": "Nutrition & Lifestyle Assessment",
    "hero.sub": "Answer a few questions to estimate calories and macros, then get food options, swaps, steps + training targets, and a simple 2-week plan.",
    "notice.top": "<b>Approximation notice:</b> This is an estimate, not an exact target. If your current intake is much lower than the estimate, increase calories gradually over time rather than making a sudden jump.",
    "s1.title": "1) Personal Data",
    "p.name": "Name",
    "p.name_ph": "e.g., Sarah",
    "p.email": "Email",
    "p.email_ph": "name@email.com",
    "p.country": "Country",
    "p.country.select": "Select",
    "s1.age": "Age (years)",
    "s1.gender": "Gender",
    "s1.gender.select": "Select",
    "s1.gender.male": "Male",
    "s1.gender.female": "Female",
    "s1.height": "Height (cm)",
    "s1.weight": "Weight (kg)",
    "s1.bfVisual.label": "Body fat estimate (visual)",
    "s1.bfVisual.selectGender": "Please select your gender first to see body fat options.",
    "s1.bfVisual.help": "Choose the closest match. If you're between two, pick the higher range.",
    "s1.bf.male.1_7.desc": "Competition level. Extremely striated, veins everywhere.",
    "s1.bf.male.8_10.desc": "Very lean. Clear striations, visible veins.",
    "s1.bf.male.11_12.desc": "Lean. Clear abs, some vascularity.",
    "s1.bf.male.13_15.desc": "Athletic. Visible abs, defined muscles.",
    "s1.bf.male.16_19.desc": "Fit. Some ab definition, less separation.",
    "s1.bf.male.20_24.desc": "Average. Little ab definition, softer look.",
    "s1.bf.male.25_30.desc": "Soft midsection. Noticeable fat around waist.",
    "s1.bf.male.35_40.desc": "Clear fat accumulation. Rounder midsection.",
    "s1.bf.female.10_12.desc": "Competition level. Extremely defined, visible striations.",
    "s1.bf.female.15_17.desc": "Very lean. Clear muscle definition, visible abs.",
    "s1.bf.female.18_20.desc": "Athletic/fit. Some ab definition, toned look.",
    "s1.bf.female.21_23.desc": "Fit. Less definition, still lean.",
    "s1.bf.female.24_26.desc": "Average/healthy. Some softness, normal look.",
    "s1.bf.female.27_29.desc": "Softer shape. More fat around hips/waist.",
    "s1.bf.female.30_35.desc": "Clear fat accumulation around body.",
    "s1.bf.female.36_40.desc": "Significant fat. Larger overall appearance.",
    "s1.bf.female.50_plus.desc": "High body fat. Much larger frame.",
    "s1.activity": "Activity level (lifestyle + training)",
    "s1.activity.select": "Select",
    "s1.activity.sedentary": "Sedentary",
    "s1.activity.light": "Lightly active",
    "s1.activity.moderate": "Moderately active",
    "s1.activity.very": "Very active",
    "s1.activity.help": `<b>Examples:</b><br/><b>Sedentary:</b> desk job, little walking, no/rare training.<br/><b>Light:</b> desk job + regular walks, training 1â€“3Ã—/week.<br/><b>Moderate:</b> active days + training 3â€“5Ã—/week (or lots of walking).<br/><b>Very active:</b> physical job OR high movement + frequent training.`,
    "s1.experience": "Training experience",
    "s1.experience.select": "Select",
    "s1.experience.none": "None",
    "s1.experience.beginner": "Beginner (0â€“2 yrs)",
    "s1.experience.intermediate": "Intermediate (2â€“5 yrs)",
    "s1.experience.advanced": "Advanced (5+ yrs)",
    "s1.trainingNow": "Currently training?",
    "s1.trainingNow.select": "Select",
    "s1.yes": "Yes",
    "s1.no": "No",
    "s1.trainedBefore": "If no: have you trained before?",
    "s1.trainingType": "Training type",
    "s1.trainingType.strength": "Strength / weights",
    "s1.trainingType.cardio": "Cardio / endurance",
    "s1.trainingType.mixed": "Mixed",
    "s1.trainingType.sport": "Sport-specific",
    "s1.trainingDetails": "What exactly do you do?",
    "s1.trainingDetails.ph": "e.g., football + gym, CrossFit, boxing...",
    "s1.sessions": "Sessions per week",
    "s1.steps": "Average daily steps",
    "s1.steps.none": "I don't track / very low",
    "s1.steps.2k": "~2,000/day",
    "s1.steps.lt4k": "< 4,000/day",
    "s1.steps.4to8k": "4,000â€“8,000/day",
    "s1.steps.8to12k": "8,000â€“12,000/day",
    "s1.steps.gt12k": "> 12,000/day",
    "s1.sleep": "Sleep per night",
    "s1.sleep.lt4": "< 4h",
    "s1.sleep.4to6": "4â€“6h",
    "s1.sleep.6to8": "6â€“8h",
    "s1.sleep.8plus": "8h+",
    "s1.goal": "Goal",
    "s1.goal.lose": "Lose fat",
    "s1.goal.maintain": "Recomposition (Lose fat / build muscle)",
    "s1.goal.gain": "Build lean muscle mass",
    "s2.title": "2) Nutrition & Eating Habits",
    "s2.note": "Choose what best matches your average week.",
    "s2.snacks": "Sugary snacks",
    "s2.sodas": "Sodas / sweetened drinks",
    "s2.fastfood": "Fast food / burgers",
    "s2.alcohol": "Alcohol (frequency)",
    "s2.tracks": "Do you track calories currently?",
    "s2.currentCals": "If you had to guess: current daily calories (optional)",
    "s2.currentCals.required": "Current daily calories (required)",
    "s2.currentCals.ph": "e.g., 2200",
    "s3.title": "3) Dietary Preferences & Constraints",
    "s3.diet": "Diet type",
    "s3.diet.omnivore": "Omnivore",
    "s3.diet.vegetarian": "Vegetarian",
    "s3.diet.vegan": "Vegan",
    "s3.allergies": "Allergies / restrictions (select all that apply)",
    "s3.allergy.milk": "Milk (Dairy)",
    "s3.allergy.egg": "Egg",
    "s3.allergy.peanut": "Peanut",
    "s3.allergy.treenuts": "Tree nuts",
    "s3.allergy.soy": "Soy",
    "s3.allergy.wheat": "Wheat",
    "s3.allergy.gluten": "Gluten",
    "s3.allergy.fish": "Fish",
    "s3.allergy.shellfish": "Shellfish",
    "s3.allergy.sesame": "Sesame",
    "s3.allergy.corn": "Corn",
    "s3.allergy.mustard": "Mustard",
    "s3.allergy.celery": "Celery",
    "s3.allergy.lupin": "Lupin",
    "s3.allergy.sulfites": "Sulfites",
    "s3.allergy.fruits": "Fruits",
    "s3.allergy.vegetables": "Vegetables",
    "s3.produce.details": "If you're allergic to fruits and/or vegetables, what exactly?",
    "s3.produce.details.ph": "e.g., strawberries, apples / tomatoes / peppers...",
    "s3.likes": "Favourite foods (comma separated)",
    "s3.likes.ph": "e.g., pasta, curry, wraps, oats",
    "s3.dislikes": "Foods you dislike / avoid (comma separated)",
    "s3.dislikes.ph": "e.g., mushrooms, tuna, eggs, rice",
    "common.select": "Select",
    "common.none": "None",
    "common.no": "No",
    "common.yes": "Yes",
    "common.sometimes": "Sometimes",
    "freq.1w": "1Ã—/week",
    "freq.2w": "2Ã—/week",
    "freq.3_5w": "3â€“5Ã—/week",
    "freq.3_4w": "3â€“4Ã—/week",
    "freq.5w": "5+Ã—/week",
    "freq.daily": "Daily",
    "results.title": "Your Results",
    "results.notice.title": "Approximation notice:",
    "results.notice.text": "This is an estimate, not an exact target. If your current intake is significantly lower than the estimate, increase calories gradually rather than making a sudden jump.",
    "results.adjust.note": "Adjust calories over time based on 2â€“4 week trends in weekly average body weight (not daily changes), supported by waist measurements, progress photos, and gym performance, and make small adjustments of ~100â€“150 calories only if progress stalls or moves in the wrong direction.",
    "results.calories": "Calories",
    "results.bmr": "BMR",
    "results.maintenance": "Estimated maintenance",
    "results.target.lose": "Target calories to lose fat:",
    "results.target.gain": "Target calories to build lean muscle mass:",
    "results.target.maintain": "Target calories for recomposition:",
    "results.more": "More (why these numbers?)",
    "results.macros": "Macro targets",
    "results.macro.chart.grams": "Macro chart (grams)",
    "results.macro.chart.calories": "Macro chart (calories)",
    "results.macros.note": "Protein: {pf} g/kg BW â€¢ Fat: {fat}% of calories â€¢ Carbs: remainder",
    "results.protein": "Protein",
    "results.carbs": "Carbs",
    "results.fats": "Fats",
    "results.gramsDay": "grams/day",
    "results.pctCalories": "% of calories",
    "results.donutNote": "Donut colors match calorie split.",
    "results.meals": "Simple meal ideas",
    "results.mealIdeas.tag": "MEAL IDEAS",
    "results.mealIdeas.sub": "Simple meal ideas",
    "results.breakfast": "Breakfast",
    "results.lunch": "Lunch",
    "results.dinner": "Dinner",
    "results.snack": "Snack (optional)",
    "results.noOptions": "No options available",
    "results.noMealsMatch": "No meal ideas match your allergies/dislikes in the current list.",
    "results.action.title": "2-week action plan",
    "results.action.cut": "1) Cut down (easy)",
    "results.action.swaps": "2) Swaps (only what you need)",
    "results.action.training": "3) Resistance training (2 weeks)",
    "results.action.steps": "4) Daily steps",
    "results.action.steps.aim": "aim for about",
    "results.action.steps.perday": "steps/day",
    "results.action.steps.after": "After that",
    "results.action.steps.add1k": "add +1,000 per week until you reach 10,000/day",
    "results.sleep": "Sleep",
    "results.send": "Do you want to receive these results?",
    "results.send.yes": "Yes, send me my results",
    "results.summary": "Your answers (summary)",
    "results.bodyComp": "Body composition (estimate)",
    "results.bfRange": "Selected range",
    "results.bfMidpoint": "BF% used (midpoint)",
    "contact.email": "Email",
    "contact.phone": "Phone number (WhatsApp)",
    "contact.note": "This opens your email/WhatsApp app with the message pre-filled. You can review before sending.",
    "contact.sendEmail": "Send by Email",
    "contact.sendWhatsApp": "Send by WhatsApp",
    "cut.sugary": "Sugary snacks",
    "cut.drinks": "Sweetened drinks",
    "cut.fastfood": "Fast food / burgers",
    "cut.alcohol": "Alcohol",
    "cut.note": "Week 1 = do it less. Week 2 = do it even less.",
    "week.1": "Week 1",
    "week.2": "Week 2",
    "timesPerWeek": "time(s) per week",
    "swap.sweet": "Sweet craving â†’ Greek yogurt + sliced banana + cinnamon",
    "swap.chocolate": "Chocolate/candy â†’ 2 squares dark chocolate + fruit",
    "swap.cookies": "Cookies â†’ protein shake + banana",
    "swap.dessert": "Dessert habit â†’ 1 planned portion after dinner (not random snacking)",
    "swap.soda": "Soda â†’ sparkling water + lemon/lime",
    "swap.sweetDrink": "Sweet drink â†’ zero-sugar drink or iced tea (no sugar)",
    "swap.energy": "Energy drink â†’ black coffee or zero-sugar version",
    "swap.fastfood": "Fast food â†’ home bowl: protein + carbs + veggies (10â€“15 min)",
    "swap.burger": "Burger â†’ homemade wrap: protein + salad + sauce",
    "swap.notime": "No time â†’ rotisserie chicken + bag salad + potatoes",
    "swap.alc.limit": "Limit alcohol to a set number of drinks",
    "swap.alc.water": "Alternate alcohol with sparkling water",
    "swap.alc.meal": "Eat a protein-rich meal before drinking",
    "swap.keep.sugary": "Sugary snacks: keep doing what you're doing âœ…",
    "swap.keep.drinks": "Sweetened drinks: keep doing what you're doing âœ…",
    "swap.keep.fastfood": "Fast food/burgers: keep doing what you're doing âœ…",
    "swap.keep.alcohol": "Alcohol: keep doing what you're doing âœ…",
    "training.workouts": "workout(s)",
    "training.note.start": "Start with 3 resistance workouts per week (simple full body).",
    "training.note.add1": "Add one extra workout per week while keeping recovery manageable.",
    "training.note.maintain": "Stay around 5â€“6 workouts/week based on recovery.",
    "training.note.progress": "Keep your current schedule and focus on progression + recovery.",
    "steps.note.to10k": "Aim to hit 10,000 steps every day.",
    "steps.note.keep": "You already do 10,000+ steps/day. Keep doing what you're doing âœ…",
    "steps.note.progress": "Week 2: add +1,000 steps/day. After that: add +1,000/week until you reach 10,000/day.",
    "sleep.note.keep": "Sleep: keep doing what you're doing. Try to stay in the 7â€“9 hour range.",
    "sleep.note.add30": "Sleep: aim for 7â€“9 hours. For 2 weeks: add +30 minutes in bed each week.",
    "sleep.note.add45_60": "Sleep: aim for 7â€“9 hours. For 2 weeks: add +45â€“60 minutes in bed each week.",
    "sleep.note.aim": "Sleep: aim for 7â€“9 hours when possible.",
    "recap.title": "Nutrition Assessment Results",
    "recap.name": "Name",
    "recap.email": "Email",
    "recap.country": "Country",
    "recap.age": "Age",
    "recap.gender": "Gender",
    "recap.height": "Height",
    "recap.weight": "Weight",
    "recap.bodyFat": "Body fat",
    "recap.goal": "Goal",
    "recap.activity": "Activity",
    "recap.trainingNow": "Currently training",
    "recap.trainedBefore": "Trained before",
    "recap.trainingType": "Training type",
    "recap.trainingDetails": "Training details",
    "recap.stepsSleep": "Steps | Sleep",
    "recap.calories": "Calories",
    "recap.bmr": "BMR",
    "recap.maintenance": "Maintenance",
    "recap.target": "Target",
    "recap.macros": "Macros",
    "goal.lose": "Lose fat",
    "goal.maintain": "Recomposition (Lose fat / build muscle)",
    "goal.gain": "Build lean muscle mass",
    "activity.sedentary": "Sedentary",
    "activity.light": "Lightly active",
    "activity.moderate": "Moderately active",
    "activity.very": "Very active",
    "steps.none": "Very low / not tracked",
    "steps.2k": "~2,000/day",
    "steps.lt4k": "< 4,000/day",
    "steps.4to8k": "4,000â€“8,000/day",
    "steps.8to12k": "8,000â€“12,000/day",
    "steps.gt12k": "> 12,000/day",
    "sleep.lt4": "< 4h",
    "sleep.4to6": "4â€“6h",
    "sleep.6to8": "6â€“8h",
    "sleep.8plus": "8h+",
    "trainingType.strength": "Strength / weights",
    "trainingType.cardio": "Cardio / endurance",
    "trainingType.mixed": "Mixed",
    "trainingType.sport": "Sport-specific",
    "why.title": "Why these targets?",
    "why.calories.title": "Calories",
    "why.calories.bmr": "BMR = baseline energy",
    "why.calories.maintenance": "Maintenance = BMR Ã— activity factor",
    "why.calories.goal": "Goal shifts the target",
    "why.calories.lose": "To lose fat, we go below maintenance so your body uses stored fat for energy.",
    "why.calories.gain": "To build lean muscle, we go above maintenance to support training and recovery.",
    "why.calories.maintain": "For recomposition, we stay near maintenance to improve body composition with training + protein.",
    "why.protein.title": "Protein",
    "why.protein.text": "Protein is based on body weight (BW) and adjusted for your body fat level using standard guidelines.",
    "why.fat.title": "Fat",
    "why.fat.text": "Fat is set based on your body fat level (leaner = slightly lower fat%, higher BF = slightly higher).",
    "why.carbs.title": "Carbs",
    "why.carbs.text": "Carbs get the remaining calories to fuel training + movement and improve adherence.",
    "why.reminder": "Reminder: it's an estimate. If you're eating far below this number now, increase slowly.",
    "btn.back": "Back",
    "btn.next": "Next",
    "btn.results": "See results",
    "btn.restart": "Restart",
    "err.fill": "Please fill these fields:",
    "err.selectBf": "Body fat estimate",
    "cta.plan.title": "Want this turned into a simple 12â€‘week plan done with you?",
    "cta.plan.btn": "Book your free 30â€‘min Game Plan Call",
    "cta.community.title": "Not ready for 1â€‘1 yet?",
    "cta.community.desc": "Join my free Skool community with courses on nutrition and body recomposition.",
    "cta.community.btn": "Join the Free Coaching Group"
  },
  fr: {
    "lang.label": "Langue",
    "badge.quiz": "ðŸ¥— <b>Quiz Nutrition</b> â€” calories, macros et plan sur 2 semaines",
    "badge.simple": "âš¡ <b>Simple</b> â€” conÃ§u pour Ãªtre facile",
    "badge.private": "ðŸ”’ <b>PrivÃ©</b> â€” fonctionne dans votre navigateur",
    "hero.title": "Ã‰valuation Nutrition & Mode de vie",
    "hero.sub": "RÃ©pondez Ã  quelques questions pour estimer vos calories et macros, puis obtenez des options de repas, des alternatives, des objectifs de pas + entraÃ®nement, et un plan simple sur 2 semaines.",
    "notice.top": "<b>Note :</b> Ceci est une estimation, pas une cible exacte. Si votre apport actuel est bien infÃ©rieur Ã  l'estimation, augmentez les calories progressivement plutÃ´t que d'un coup.",
    "s1.title": "1) DonnÃ©es personnelles",
    "p.name": "PrÃ©nom",
    "p.name_ph": "ex. Sarah",
    "p.email": "Email",
    "p.email_ph": "nom@email.com",
    "p.country": "Pays",
    "p.country.select": "SÃ©lectionner",
    "s1.age": "Ã‚ge (annÃ©es)",
    "s1.gender": "Sexe",
    "s1.gender.select": "SÃ©lectionner",
    "s1.gender.male": "Homme",
    "s1.gender.female": "Femme",
    "s1.height": "Taille (cm)",
    "s1.weight": "Poids (kg)",
    "s1.bfVisual.label": "Estimation du taux de graisse corporelle (visuel)",
    "s1.bfVisual.selectGender": "Veuillez d'abord sÃ©lectionner votre sexe pour voir les options.",
    "s1.bfVisual.help": "Choisissez la correspondance la plus proche. En cas de doute, choisissez la fourchette supÃ©rieure.",
    "s1.bf.male.1_7.desc": "Niveau compÃ©tition. Striations extrÃªmes, veines partout.",
    "s1.bf.male.8_10.desc": "TrÃ¨s sec. Striations claires, veines visibles.",
    "s1.bf.male.11_12.desc": "Sec. Abdos clairs, quelques veines.",
    "s1.bf.male.13_15.desc": "AthlÃ©tique. Abdos visibles, muscles dÃ©finis.",
    "s1.bf.male.16_19.desc": "Fit. Un peu de dÃ©finition abdominale.",
    "s1.bf.male.20_24.desc": "Moyen. Peu de dÃ©finition, look plus doux.",
    "s1.bf.male.25_30.desc": "Ventre mou. Graisse visible autour de la taille.",
    "s1.bf.male.35_40.desc": "Accumulation de graisse visible. Ventre plus rond.",
    "s1.bf.female.10_12.desc": "Niveau compÃ©tition. TrÃ¨s dÃ©finie, striations visibles.",
    "s1.bf.female.15_17.desc": "TrÃ¨s sÃ¨che. DÃ©finition musculaire claire, abdos visibles.",
    "s1.bf.female.18_20.desc": "AthlÃ©tique/fit. Quelques abdos, look tonique.",
    "s1.bf.female.21_23.desc": "Fit. Moins de dÃ©finition, toujours sÃ¨che.",
    "s1.bf.female.24_26.desc": "Moyenne/saine. Un peu de douceur, look normal.",
    "s1.bf.female.27_29.desc": "Formes plus douces. Plus de graisse hanches/taille.",
    "s1.bf.female.30_35.desc": "Accumulation de graisse visible sur le corps.",
    "s1.bf.female.36_40.desc": "Graisse importante. Apparence plus large.",
    "s1.bf.female.50_plus.desc": "Graisse corporelle Ã©levÃ©e. Silhouette beaucoup plus large.",
    "s1.activity": "Niveau d'activitÃ© (mode de vie + entraÃ®nement)",
    "s1.activity.select": "SÃ©lectionner",
    "s1.activity.sedentary": "SÃ©dentaire",
    "s1.activity.light": "LÃ©gÃ¨rement actif",
    "s1.activity.moderate": "ModÃ©rÃ©ment actif",
    "s1.activity.very": "TrÃ¨s actif",
    "s1.activity.help": `<b>Exemples :</b><br/><b>SÃ©dentaire :</b> travail de bureau, peu de marche, pas/rare entraÃ®nement.<br/><b>LÃ©ger :</b> bureau + marches rÃ©guliÃ¨res, entraÃ®nement 1â€“3Ã—/semaine.<br/><b>ModÃ©rÃ© :</b> journÃ©es actives + entraÃ®nement 3â€“5Ã—/semaine (ou beaucoup de marche).<br/><b>TrÃ¨s actif :</b> travail physique OU beaucoup de mouvement + entraÃ®nement frÃ©quent.`,
    "s1.experience": "ExpÃ©rience d'entraÃ®nement",
    "s1.experience.select": "SÃ©lectionner",
    "s1.experience.none": "Aucune",
    "s1.experience.beginner": "DÃ©butant (0â€“2 ans)",
    "s1.experience.intermediate": "IntermÃ©diaire (2â€“5 ans)",
    "s1.experience.advanced": "AvancÃ© (5+ ans)",
    "s1.trainingNow": "Vous vous entraÃ®nez actuellement ?",
    "s1.trainingNow.select": "SÃ©lectionner",
    "s1.yes": "Oui",
    "s1.no": "Non",
    "s1.trainedBefore": "Si non : avez-vous dÃ©jÃ  fait du sport avant ?",
    "s1.trainingType": "Type d'entraÃ®nement",
    "s1.trainingType.strength": "Musculation / poids",
    "s1.trainingType.cardio": "Cardio / endurance",
    "s1.trainingType.mixed": "Mixte",
    "s1.trainingType.sport": "Sport spÃ©cifique",
    "s1.trainingDetails": "Que faites-vous exactement ?",
    "s1.trainingDetails.ph": "ex. football + salle, CrossFit, boxe...",
    "s1.sessions": "SÃ©ances par semaine",
    "s1.steps": "Pas quotidiens moyens",
    "s1.steps.none": "Je ne suis pas / trÃ¨s faible",
    "s1.steps.2k": "~2 000/jour",
    "s1.steps.lt4k": "< 4 000/jour",
    "s1.steps.4to8k": "4 000â€“8 000/jour",
    "s1.steps.8to12k": "8 000â€“12 000/jour",
    "s1.steps.gt12k": "> 12 000/jour",
    "s1.sleep": "Sommeil par nuit",
    "s1.sleep.lt4": "< 4 h",
    "s1.sleep.4to6": "4â€“6 h",
    "s1.sleep.6to8": "6â€“8 h",
    "s1.sleep.8plus": "8 h+",
    "s1.goal": "Objectif",
    "s1.goal.lose": "Perdre de la graisse",
    "s1.goal.maintain": "Recomposition (Perdre du gras / construire du muscle)",
    "s1.goal.gain": "Construire de la masse musculaire",
    "s2.title": "2) Nutrition & Habitudes alimentaires",
    "s2.note": "Choisissez ce qui correspond le mieux Ã  votre semaine moyenne.",
    "s2.snacks": "Snacks sucrÃ©s",
    "s2.sodas": "Sodas / boissons sucrÃ©es",
    "s2.fastfood": "Fast-food / burgers",
    "s2.alcohol": "Alcool (frÃ©quence)",
    "s2.tracks": "Suivez-vous actuellement vos calories ?",
    "s2.currentCals": "Si vous deviez estimer : calories quotidiennes actuelles (optionnel)",
    "s2.currentCals.required": "Calories quotidiennes actuelles (obligatoire)",
    "s2.currentCals.ph": "ex. 2200",
    "s3.title": "3) PrÃ©fÃ©rences alimentaires & Restrictions",
    "s3.diet": "Type d'alimentation",
    "s3.diet.omnivore": "Omnivore",
    "s3.diet.vegetarian": "VÃ©gÃ©tarien",
    "s3.diet.vegan": "VÃ©gane",
    "s3.allergies": "Allergies / restrictions (sÃ©lectionnez tout ce qui s'applique)",
    "s3.allergy.milk": "Lait (produits laitiers)",
    "s3.allergy.egg": "Å’uf",
    "s3.allergy.peanut": "Arachide",
    "s3.allergy.treenuts": "Fruits Ã  coque",
    "s3.allergy.soy": "Soja",
    "s3.allergy.wheat": "BlÃ©",
    "s3.allergy.gluten": "Gluten",
    "s3.allergy.fish": "Poisson",
    "s3.allergy.shellfish": "Fruits de mer",
    "s3.allergy.sesame": "SÃ©same",
    "s3.allergy.corn": "MaÃ¯s",
    "s3.allergy.mustard": "Moutarde",
    "s3.allergy.celery": "CÃ©leri",
    "s3.allergy.lupin": "Lupin",
    "s3.allergy.sulfites": "Sulfites",
    "s3.allergy.fruits": "Fruits",
    "s3.allergy.vegetables": "LÃ©gumes",
    "s3.produce.details": "Si vous Ãªtes allergique aux fruits et/ou lÃ©gumes, lesquels ?",
    "s3.produce.details.ph": "ex. fraises, pommes / tomates / poivrons...",
    "s3.likes": "Aliments prÃ©fÃ©rÃ©s (sÃ©parÃ©s par des virgules)",
    "s3.likes.ph": "ex. pÃ¢tes, curry, wraps, flocons d'avoine",
    "s3.dislikes": "Aliments que vous n'aimez pas / Ã©vitez (sÃ©parÃ©s par des virgules)",
    "s3.dislikes.ph": "ex. champignons, thon, Å“ufs, riz",
    "common.select": "SÃ©lectionner",
    "common.none": "Aucun",
    "common.no": "Non",
    "common.yes": "Oui",
    "common.sometimes": "Parfois",
    "freq.1w": "1Ã—/semaine",
    "freq.2w": "2Ã—/semaine",
    "freq.3_5w": "3â€“5Ã—/semaine",
    "freq.3_4w": "3â€“4Ã—/semaine",
    "freq.5w": "5+Ã—/semaine",
    "freq.daily": "Tous les jours",
    "results.title": "Vos rÃ©sultats",
    "results.notice.title": "Avertissement :",
    "results.notice.text": "Il s'agit d'une estimation, pas d'un objectif exact. Si votre apport actuel est nettement infÃ©rieur Ã  cette estimation, augmentez les calories progressivement plutÃ´t que brutalement.",
    "results.adjust.note": "Ajustez les calories au fil du temps en fonction des tendances sur 2 Ã  4 semaines de la moyenne hebdomadaire du poids corporel (pas des changements quotidiens), appuyÃ©es par les mesures de tour de taille, les photos de progression et les performances en salle, et effectuez de petits ajustements de ~100â€“150 calories uniquement si les progrÃ¨s stagnent ou vont dans la mauvaise direction.",
    "results.calories": "Calories",
    "results.bmr": "MBR (mÃ©tabolisme de base)",
    "results.maintenance": "Maintenance estimÃ©e",
    "results.target.lose": "Apport cible pour perdre de la graisse :",
    "results.target.gain": "Apport cible pour dÃ©velopper de la masse musculaire :",
    "results.target.maintain": "Apport cible pour recomposition :",
    "results.more": "Plus de dÃ©tails (pourquoi ces chiffres ?)",
    "results.macros": "Objectifs en macronutriments",
    "results.macro.chart.grams": "RÃ©partition des macros (grammes)",
    "results.macro.chart.calories": "RÃ©partition des macros (calories)",
    "results.macros.note": "ProtÃ©ines : {pf} g/kg PC â€¢ Lipides : {fat}% des calories â€¢ Glucides : le reste",
    "results.protein": "ProtÃ©ines",
    "results.carbs": "Glucides",
    "results.fats": "Lipides",
    "results.gramsDay": "g/jour",
    "results.pctCalories": "% des calories",
    "results.donutNote": "Les couleurs correspondent Ã  la rÃ©partition calorique.",
    "results.meals": "IdÃ©es de repas simples",
    "results.mealIdeas.tag": "IDÃ‰ES REPAS",
    "results.mealIdeas.sub": "IdÃ©es simples",
    "results.breakfast": "Petit-dÃ©jeuner",
    "results.lunch": "DÃ©jeuner",
    "results.dinner": "DÃ®ner",
    "results.snack": "Collation (optionnelle)",
    "results.noOptions": "Aucune option disponible",
    "results.noMealsMatch": "Aucune idÃ©e de repas ne correspond Ã  vos allergies/aversions dans la liste actuelle.",
    "results.action.title": "Plan d'action sur 2 semaines",
    "results.action.cut": "1) RÃ©duire progressivement (simple)",
    "results.action.swaps": "2) Substitutions (uniquement si nÃ©cessaire)",
    "results.action.training": "3) EntraÃ®nement en rÃ©sistance (2 semaines)",
    "results.action.steps": "4) Pas quotidiens",
    "results.action.steps.aim": "viser environ",
    "results.action.steps.perday": "pas/jour",
    "results.action.steps.after": "Ensuite",
    "results.action.steps.add1k": "ajouter +1 000 par semaine jusqu'Ã  10 000/jour",
    "results.sleep": "Sommeil",
    "results.send": "Souhaitez-vous recevoir ces rÃ©sultats ?",
    "results.send.yes": "Oui, envoyez-moi mes rÃ©sultats",
    "results.summary": "RÃ©capitulatif de vos rÃ©ponses",
    "results.bodyComp": "Composition corporelle (estimation)",
    "results.bfRange": "Fourchette sÃ©lectionnÃ©e",
    "results.bfMidpoint": "% graisse utilisÃ© (milieu)",
    "contact.email": "Email",
    "contact.phone": "NumÃ©ro de tÃ©lÃ©phone (WhatsApp)",
    "contact.note": "Cela ouvre votre email/WhatsApp avec le message prÃ©-rempli. Vous pouvez vÃ©rifier avant d'envoyer.",
    "contact.sendEmail": "Envoyer par email",
    "contact.sendWhatsApp": "Envoyer par WhatsApp",
    "cut.sugary": "Snacks sucrÃ©s",
    "cut.drinks": "Boissons sucrÃ©es",
    "cut.fastfood": "Fast-food / burgers",
    "cut.alcohol": "Alcool",
    "cut.note": "Semaine 1 = rÃ©duis. Semaine 2 = rÃ©duis encore plus.",
    "week.1": "Semaine 1",
    "week.2": "Semaine 2",
    "timesPerWeek": "fois par semaine",
    "swap.sweet": "Envie de sucrÃ© â†’ yaourt grec + banane en rondelles + cannelle",
    "swap.chocolate": "Chocolat / bonbons â†’ 2 carrÃ©s de chocolat noir + fruit",
    "swap.cookies": "Biscuits â†’ shake protÃ©inÃ© + banane",
    "swap.dessert": "Habitude dessert â†’ 1 portion planifiÃ©e aprÃ¨s le dÃ®ner (pas de grignotage alÃ©atoire)",
    "swap.soda": "Soda â†’ eau pÃ©tillante + citron / citron vert",
    "swap.sweetDrink": "Boisson sucrÃ©e â†’ boisson sans sucre ou thÃ© glacÃ© (sans sucre)",
    "swap.energy": "Boisson Ã©nergisante â†’ cafÃ© noir ou version sans sucre",
    "swap.fastfood": "Fast-food â†’ bol maison : protÃ©ines + glucides + lÃ©gumes (10â€“15 min)",
    "swap.burger": "Burger â†’ wrap maison : protÃ©ines + salade + sauce",
    "swap.notime": "Pas le temps â†’ poulet rÃ´ti + salade en sachet + pommes de terre",
    "swap.alc.limit": "Limiter l'alcool Ã  un nombre dÃ©fini de verres",
    "swap.alc.water": "Alterner l'alcool avec de l'eau pÃ©tillante",
    "swap.alc.meal": "Manger un repas riche en protÃ©ines avant de boire",
    "swap.keep.sugary": "Snacks sucrÃ©s : continue comme Ã§a âœ…",
       "swap.keep.drinks": "Boissons sucrÃ©es : continue comme Ã§a âœ…",
    "swap.keep.fastfood": "Fast-food / burgers : continue comme Ã§a âœ…",
    "swap.keep.alcohol": "Alcool : continue comme Ã§a âœ…",
    "training.workouts": "sÃ©ance(s)",
    "training.note.start": "Commence avec 3 sÃ©ances de musculation par semaine (full body simple).",
    "training.note.add1": "Ajoute une sÃ©ance par semaine tout en gardant une rÃ©cupÃ©ration correcte.",
    "training.note.maintain": "Reste autour de 5â€“6 sÃ©ances/semaine selon ta rÃ©cupÃ©ration.",
    "training.note.progress": "Garde ton rythme actuel et concentre-toi sur la progression + la rÃ©cupÃ©ration.",
    "steps.note.to10k": "Vise 10 000 pas par jour.",
    "steps.note.keep": "Tu fais dÃ©jÃ  10 000+ pas/jour. Continue comme Ã§a âœ…",
    "steps.note.progress": "Semaine 2 : +1 000 pas/jour. Ensuite : +1 000/semaine jusqu'Ã  atteindre 10 000/jour.",
    "sleep.note.keep": "Sommeil : continue comme Ã§a. Essaie de rester dans la zone 7â€“9 h.",
    "sleep.note.add30": "Sommeil : vise 7â€“9 h. Pendant 2 semaines : +30 min au lit chaque semaine.",
    "sleep.note.add45_60": "Sommeil : vise 7â€“9 h. Pendant 2 semaines : +45â€“60 min au lit chaque semaine.",
    "sleep.note.aim": "Sommeil : vise 7â€“9 h quand c'est possible.",
    "recap.title": "RÃ©sultats de l'Ã©valuation nutritionnelle",
    "recap.name": "PrÃ©nom",
    "recap.email": "Email",
    "recap.country": "Pays",
    "recap.age": "Ã‚ge",
    "recap.gender": "Sexe",
    "recap.height": "Taille",
    "recap.weight": "Poids",
    "recap.bodyFat": "Graisse corporelle",
    "recap.goal": "Objectif",
    "recap.activity": "ActivitÃ©",
    "recap.trainingNow": "EntraÃ®nement actuel",
    "recap.trainedBefore": "DÃ©jÃ  entraÃ®nÃ©",
    "recap.trainingType": "Type d'entraÃ®nement",
    "recap.trainingDetails": "DÃ©tails de l'entraÃ®nement",
    "recap.stepsSleep": "Pas | Sommeil",
    "recap.calories": "Calories",
    "recap.bmr": "MBR",
    "recap.maintenance": "Maintenance",
    "recap.target": "Cible",
    "recap.macros": "Macros",
    "goal.lose": "Perdre de la graisse",
    "goal.maintain": "Recomposition (Perdre du gras / construire du muscle)",
    "goal.gain": "Construire de la masse musculaire",
    "activity.sedentary": "SÃ©dentaire",
    "activity.light": "LÃ©gÃ¨rement actif",
    "activity.moderate": "ModÃ©rÃ©ment actif",
    "activity.very": "TrÃ¨s actif",
    "steps.none": "TrÃ¨s faible / non suivi",
    "steps.2k": "~2 000/jour",
    "steps.lt4k": "< 4 000/jour",
    "steps.4to8k": "4 000â€“8 000/jour",
    "steps.8to12k": "8 000â€“12 000/jour",
    "steps.gt12k": "> 12 000/jour",
    "sleep.lt4": "< 4h",
    "sleep.4to6": "4â€“6h",
    "sleep.6to8": "6â€“8h",
    "sleep.8plus": "8h+",
    "trainingType.strength": "Musculation / poids",
    "trainingType.cardio": "Cardio / endurance",
    "trainingType.mixed": "Mixte",
    "trainingType.sport": "Sport spÃ©cifique",
    "why.title": "Pourquoi ces valeurs ?",
    "why.calories.title": "Calories",
    "why.calories.bmr": "MBR = Ã©nergie de base",
    "why.calories.maintenance": "Maintenance = MBR Ã— facteur d'activitÃ©",
    "why.calories.goal": "L'objectif ajuste la cible",
    "why.calories.lose": "Pour perdre de la graisse, on descend sous la maintenance afin que le corps utilise les rÃ©serves.",
    "why.calories.gain": "Pour construire du muscle, on dÃ©passe la maintenance pour soutenir l'entraÃ®nement et la rÃ©cupÃ©ration.",
    "why.calories.maintain": "Pour la recomposition, on reste proche de la maintenance pour amÃ©liorer la composition corporelle avec l'entraÃ®nement + protÃ©ines.",
    "why.protein.title": "ProtÃ©ines",
    "why.protein.text": "BasÃ©es sur le poids corporel (PC) et ajustÃ©es selon votre taux de graisse corporelle selon les recommandations standards.",
    "why.fat.title": "Lipides",
    "why.fat.text": "BasÃ©s sur votre taux de graisse (plus sec = un peu moins, plus gras = un peu plus).",
    "why.carbs.title": "Glucides",
    "why.carbs.text": "Le reste des calories pour soutenir l'entraÃ®nement et l'activitÃ©, et amÃ©liorer l'adhÃ©rence.",
    "why.reminder": "Rappel : il s'agit d'une estimation. Si ton apport actuel est bien infÃ©rieur, augmente progressivement.",
    "btn.back": "Retour",
    "btn.next": "Suivant",
    "btn.results": "Voir les rÃ©sultats",
    "btn.restart": "Recommencer",
    "err.fill": "Veuillez remplir ces champs :",
    "err.selectBf": "Estimation graisse corporelle",
    "cta.plan.title": "Tu veux transformer Ã§a en un plan simple de 12 semaines, fait avec toi ?",
    "cta.plan.btn": "RÃ©serve ton appel gratuit de 30 min",
    "cta.community.title": "Pas encore prÃªt pour du 1-1 ?",
    "cta.community.desc": "Rejoins ma communautÃ© Skool gratuite avec des cours sur la nutrition et la recomposition corporelle.",
    "cta.community.btn": "Rejoindre le groupe gratuit"
  },
  de: {
    "lang.label": "Sprache",
    "badge.quiz": "ðŸ¥— <b>ErnÃ¤hrungs-Quiz</b> â€” Kalorien, Makros & 2-Wochen-Plan",
    "badge.simple": "âš¡ <b>Einfach</b> â€” bewusst leicht gemacht",
    "badge.private": "ðŸ”’ <b>Privat</b> â€” lÃ¤uft im Browser",
    "hero.title": "ErnÃ¤hrungs- & Lifestyle-Check",
    "hero.sub": "Beantworte ein paar Fragen, um Kalorien und Makros zu schÃ¤tzen. Danach bekommst du Essensideen, Alternativen, Schritte- & Trainingsziele sowie einen einfachen 2-Wochen-Plan.",
    "notice.top": "<b>Hinweis:</b> Das ist eine SchÃ¤tzung, kein exaktes Ziel. Wenn deine aktuelle Kalorienzufuhr deutlich darunter liegt, erhÃ¶he schrittweise statt abrupt.",
    "s1.title": "1) PersÃ¶nliche Daten",
    "p.name": "Name",
    "p.name_ph": "z. B. Sarah",
    "p.email": "E-Mail",
    "p.email_ph": "name@email.com",
    "p.country": "Land",
    "p.country.select": "AuswÃ¤hlen",
    "s1.age": "Alter (Jahre)",
    "s1.gender": "Geschlecht",
    "s1.gender.select": "AuswÃ¤hlen",
    "s1.gender.male": "MÃ¤nnlich",
    "s1.gender.female": "Weiblich",
    "s1.height": "GrÃ¶ÃŸe (cm)",
    "s1.weight": "Gewicht (kg)",
    "s1.bfVisual.label": "KÃ¶rperfett-SchÃ¤tzung (visuell)",
    "s1.bfVisual.selectGender": "Bitte wÃ¤hle zuerst dein Geschlecht, um die Optionen zu sehen.",
    "s1.bfVisual.help": "WÃ¤hle die nÃ¤chste Ãœbereinstimmung. Im Zweifel wÃ¤hle den hÃ¶heren Bereich.",
    "s1.bf.male.1_7.desc": "Wettkampfniveau. Extreme Striationen, Venen Ã¼berall.",
    "s1.bf.male.8_10.desc": "Sehr schlank. Klare Striationen, sichtbare Venen.",
    "s1.bf.male.11_12.desc": "Schlank. Klare Bauchmuskeln, etwas VaskularitÃ¤t.",
    "s1.bf.male.13_15.desc": "Athletisch. Sichtbare Bauchmuskeln, definierte Muskeln.",
    "s1.bf.male.16_19.desc": "Fit. Etwas Bauchmuskeldefinition.",
    "s1.bf.male.20_24.desc": "Durchschnitt. Wenig Definition, weicherer Look.",
    "s1.bf.male.25_30.desc": "Weiche KÃ¶rpermitte. Sichtbares Fett um die Taille.",
    "s1.bf.male.35_40.desc": "Deutliche Fettansammlung. Rundere KÃ¶rpermitte.",
    "s1.bf.female.10_12.desc": "Wettkampfniveau. Extrem definiert, sichtbare Striationen.",
    "s1.bf.female.15_17.desc": "Sehr schlank. Klare Muskeldefinition, sichtbare Bauchmuskeln.",
    "s1.bf.female.18_20.desc": "Athletisch/fit. Etwas Bauchmuskeldefinition, trainierter Look.",
    "s1.bf.female.21_23.desc": "Fit. Weniger Definition, trotzdem schlank.",
    "s1.bf.female.24_26.desc": "Durchschnitt/gesund. Etwas Weichheit, normaler Look.",
    "s1.bf.female.27_29.desc": "Weichere Form. Mehr Fett um HÃ¼ften/Taille.",
    "s1.bf.female.30_35.desc": "Deutliche Fettansammlung am KÃ¶rper.",
    "s1.bf.female.36_40.desc": "Erhebliches Fett. GrÃ¶ÃŸeres Gesamterscheinungsbild.",
    "s1.bf.female.50_plus.desc": "Hoher KÃ¶rperfettanteil. Deutlich grÃ¶ÃŸere Statur.",
    "s1.activity": "AktivitÃ¤tslevel (Alltag + Training)",
    "s1.activity.select": "AuswÃ¤hlen",
    "s1.activity.sedentary": "Sitzend",
    "s1.activity.light": "Leicht aktiv",
    "s1.activity.moderate": "MÃ¤ÃŸig aktiv",
    "s1.activity.very": "Sehr aktiv",
    "s1.activity.help": `<b>Beispiele:</b><br/><b>Sitzend:</b> BÃ¼rojob, wenig Gehen, kein/selten Training.<br/><b>Leicht:</b> BÃ¼rojob + regelmÃ¤ÃŸige SpaziergÃ¤nge, Training 1â€“3Ã—/Woche.<br/><b>MÃ¤ÃŸig:</b> aktive Tage + Training 3â€“5Ã—/Woche (oder viel Gehen).<br/><b>Sehr aktiv:</b> kÃ¶rperlicher Job ODER viel Bewegung + hÃ¤ufiges Training.`,
    "s1.experience": "Trainingserfahrung",
    "s1.experience.select": "AuswÃ¤hlen",
    "s1.experience.none": "Keine",
    "s1.experience.beginner": "AnfÃ¤nger (0â€“2 J.)",
    "s1.experience.intermediate": "Fortgeschritten (2â€“5 J.)",
    "s1.experience.advanced": "Sehr erfahren (5+ J.)",
    "s1.trainingNow": "Trainierst du aktuell?",
    "s1.trainingNow.select": "AuswÃ¤hlen",
    "s1.yes": "Ja",
    "s1.no": "Nein",
    "s1.trainedBefore": "Wenn nein: hast du frÃ¼her schon trainiert?",
    "s1.trainingType": "Trainingsart",
    "s1.trainingType.strength": "Krafttraining / Gewichte",
    "s1.trainingType.cardio": "Cardio / Ausdauer",
    "s1.trainingType.mixed": "Gemischt",
    "s1.trainingType.sport": "Sportspezifisch",
    "s1.trainingDetails": "Was genau machst du?",
    "s1.trainingDetails.ph": "z. B. FuÃŸball + Fitnessstudio, CrossFit, Boxen...",
    "s1.sessions": "Einheiten pro Woche",
    "s1.steps": "Durchschnittliche tÃ¤gliche Schritte",
    "s1.steps.none": "Ich tracke nicht / sehr niedrig",
    "s1.steps.2k": "~2.000/Tag",
    "s1.steps.lt4k": "< 4.000/Tag",
    "s1.steps.4to8k": "4.000â€“8.000/Tag",
    "s1.steps.8to12k": "8.000â€“12.000/Tag",
    "s1.steps.gt12k": "> 12.000/Tag",
    "s1.sleep": "Schlaf pro Nacht",
    "s1.sleep.lt4": "< 4 Std.",
    "s1.sleep.4to6": "4â€“6 Std.",
    "s1.sleep.6to8": "6â€“8 Std.",
    "s1.sleep.8plus": "8 Std.+",
    "s1.goal": "Ziel",
    "s1.goal.lose": "Fett verlieren",
    "s1.goal.maintain": "Rekomposition (Fett verlieren / Muskeln aufbauen)",
    "s1.goal.gain": "Muskelmasse aufbauen",
    "s2.title": "2) ErnÃ¤hrung & Essgewohnheiten",
    "s2.note": "WÃ¤hle, was am besten zu deiner durchschnittlichen Woche passt.",
    "s2.snacks": "Zuckerhaltige Snacks",
    "s2.sodas": "Limonaden / gesÃ¼ÃŸte GetrÃ¤nke",
    "s2.fastfood": "Fast Food / Burger",
    "s2.alcohol": "Alkohol (HÃ¤ufigkeit)",
    "s2.tracks": "Verfolgst du aktuell deine Kalorien?",
    "s2.currentCals": "Falls du schÃ¤tzen mÃ¼sstest: aktuelle tÃ¤gliche Kalorien (optional)",
    "s2.currentCals.required": "Aktuelle tÃ¤gliche Kalorien (erforderlich)",
    "s2.currentCals.ph": "z. B. 2200",
    "s3.title": "3) ErnÃ¤hrungsprÃ¤ferenzen & EinschrÃ¤nkungen",
    "s3.diet": "ErnÃ¤hrungsform",
    "s3.diet.omnivore": "Allesesser",
    "s3.diet.vegetarian": "Vegetarisch",
    "s3.diet.vegan": "Vegan",
    "s3.allergies": "Allergien / EinschrÃ¤nkungen (alles Zutreffende auswÃ¤hlen)",
    "s3.allergy.milk": "Milch (Milchprodukte)",
    "s3.allergy.egg": "Ei",
    "s3.allergy.peanut": "Erdnuss",
    "s3.allergy.treenuts": "SchalenfrÃ¼chte",
    "s3.allergy.soy": "Soja",
    "s3.allergy.wheat": "Weizen",
    "s3.allergy.gluten": "Gluten",
    "s3.allergy.fish": "Fisch",
    "s3.allergy.shellfish": "Schalentiere",
    "s3.allergy.sesame": "Sesam",
    "s3.allergy.corn": "Mais",
    "s3.allergy.mustard": "Senf",
    "s3.allergy.celery": "Sellerie",
    "s3.allergy.lupin": "Lupine",
    "s3.allergy.sulfites": "Sulfite",
    "s3.allergy.fruits": "Obst",
    "s3.allergy.vegetables": "GemÃ¼se",
    "s3.produce.details": "Wenn du gegen Obst und/oder GemÃ¼se allergisch bist â€“ gegen welche?",
    "s3.produce.details.ph": "z. B. Erdbeeren, Ã„pfel / Tomaten / Paprika...",
    "s3.likes": "Lieblingslebensmittel (durch Kommas getrennt)",
    "s3.likes.ph": "z. B. Pasta, Curry, Wraps, Haferflocken",
    "s3.dislikes": "Lebensmittel, die du nicht magst / vermeidest (durch Kommas getrennt)",
    "s3.dislikes.ph": "z. B. Pilze, Thunfisch, Eier, Reis",
    "common.select": "AuswÃ¤hlen",
    "common.none": "Keine",
    "common.no": "Nein",
    "common.yes": "Ja",
    "common.sometimes": "Manchmal",
    "freq.1w": "1Ã—/Woche",
    "freq.2w": "2Ã—/Woche",
    "freq.3_5w": "3â€“5Ã—/Woche",
    "freq.3_4w": "3â€“4Ã—/Woche",
    "freq.5w": "5+Ã—/Woche",
    "freq.daily": "TÃ¤glich",
    "results.title": "Deine Ergebnisse",
    "results.notice.title": "Hinweis:",
    "results.notice.text": "Dies ist eine SchÃ¤tzung, kein exakter Zielwert. Wenn deine aktuelle Kalorienzufuhr deutlich darunter liegt, erhÃ¶he sie schrittweise und nicht abrupt.",
    "results.adjust.note": "Passe die Kalorien im Laufe der Zeit basierend auf 2â€“4 Wochen Trends des wÃ¶chentlichen Durchschnittsgewichts (nicht tÃ¤glicher Ã„nderungen) an, unterstÃ¼tzt durch Taillenumfang, Fortschrittsfotos und Trainingsleistung, und nimm kleine Anpassungen von ~100â€“150 Kalorien nur vor, wenn der Fortschritt stagniert oder in die falsche Richtung geht.",
    "results.calories": "Kalorien",
    "results.bmr": "Grundumsatz (BMR)",
    "results.maintenance": "GeschÃ¤tzter Erhaltungsbedarf",
    "results.target.lose": "Zielkalorien fÃ¼r Fettverlust:",
    "results.target.gain": "Zielkalorien fÃ¼r Muskelaufbau:",
    "results.target.maintain": "Zielkalorien fÃ¼r Rekomposition:",
    "results.more": "Mehr Infos (warum diese Werte?)",
    "results.macros": "Makroziele",
    "results.macro.chart.grams": "MakroÃ¼bersicht (Gramm)",
    "results.macro.chart.calories": "MakroÃ¼bersicht (Kalorien)",
    "results.macros.note": "Protein: {pf} g/kg KG â€¢ Fett: {fat}% der Kalorien â€¢ Kohlenhydrate: Rest",
    "results.protein": "Protein",
    "results.carbs": "Kohlenhydrate",
    "results.fats": "Fette",
    "results.gramsDay": "g/Tag",
    "results.pctCalories": "% der Kalorien",
    "results.donutNote": "Die Farben entsprechen der Kalorienverteilung.",
    "results.meals": "Einfache Mahlzeitenideen",
    "results.mealIdeas.tag": "MAHLZEITIDEEN",
    "results.mealIdeas.sub": "Einfache Ideen",
    "results.breakfast": "FrÃ¼hstÃ¼ck",
    "results.lunch": "Mittagessen",
    "results.dinner": "Abendessen",
    "results.snack": "Snack (optional)",
    "results.noOptions": "Keine Optionen verfÃ¼gbar",
    "results.noMealsMatch": "Keine Mahlzeitenideen passen zu deinen Allergien/Abneigungen in der aktuellen Liste.",
    "results.action.title": "2-Wochen-Aktionsplan",
    "results.action.cut": "1) Reduzieren (einfach)",
    "results.action.swaps": "2) Alternativen (nur wenn nÃ¶tig)",
    "results.action.training": "3) Krafttraining (2 Wochen)",
    "results.action.steps": "4) TÃ¤gliche Schritte",
    "results.action.steps.aim": "anstreben etwa",
    "results.action.steps.perday": "Schritte/Tag",
    "results.action.steps.after": "Danach",
    "results.action.steps.add1k": "+1.000 pro Woche hinzufÃ¼gen bis 10.000/Tag",
    "results.sleep": "Schlaf",
    "results.send": "MÃ¶chtest du diese Ergebnisse erhalten?",
    "results.send.yes": "Ja, sende mir meine Ergebnisse",
    "results.summary": "Zusammenfassung deiner Angaben",
    "results.bodyComp": "KÃ¶rperzusammensetzung (SchÃ¤tzung)",
    "results.bfRange": "AusgewÃ¤hlter Bereich",
    "results.bfMidpoint": "KF% verwendet (Mitte)",
    "contact.email": "E-Mail",
    "contact.phone": "Telefonnummer (WhatsApp)",
    "contact.note": "Das Ã¶ffnet E-Mail/WhatsApp mit vorausgefÃ¼llter Nachricht. Du kannst vor dem Senden prÃ¼fen.",
    "contact.sendEmail": "Per E-Mail senden",
    "contact.sendWhatsApp": "Per WhatsApp senden",
    "cut.sugary": "Zuckerhaltige Snacks",
    "cut.drinks": "GesÃ¼ÃŸte GetrÃ¤nke",
    "cut.fastfood": "Fast Food / Burger",
    "cut.alcohol": "Alkohol",
    "cut.note": "Woche 1 = weniger. Woche 2 = noch weniger.",
    "week.1": "Woche 1",
    "week.2": "Woche 2",
    "timesPerWeek": "Mal pro Woche",
    "swap.sweet": "SÃ¼ÃŸhunger â†’ griechischer Joghurt + geschnittene Banane + Zimt",
    "swap.chocolate": "Schokolade / SÃ¼ÃŸigkeiten â†’ 2 StÃ¼ck dunkle Schokolade + Obst",
    "swap.cookies": "Kekse â†’ Proteinshake + Banane",
    "swap.dessert": "Dessert-Gewohnheit â†’ 1 geplante Portion nach dem Abendessen (kein ungeplantes Snacken)",
    "swap.soda": "Limonade â†’ Sprudelwasser + Zitrone / Limette",
    "swap.sweetDrink": "SÃ¼ÃŸes GetrÃ¤nk â†’ zuckerfreies GetrÃ¤nk oder Eistee (ohne Zucker)",
    "swap.energy": "Energy-Drink â†’ schwarzer Kaffee oder zuckerfreie Variante",
    "swap.fastfood": "Fast Food â†’ selbstgemachte Bowl: Protein + Kohlenhydrate + GemÃ¼se (10â€“15 Min.)",
    "swap.burger": "Burger â†’ selbstgemachter Wrap: Protein + Salat + Sauce",
    "swap.notime": "Keine Zeit â†’ GrillhÃ¤hnchen + Beutelsalat + Kartoffeln",
    "swap.alc.limit": "Alkohol auf eine feste Anzahl an GetrÃ¤nken begrenzen",
    "swap.alc.water": "Alkohol mit Sprudelwasser abwechseln",
    "swap.alc.meal": "Vor dem Trinken eine proteinreiche Mahlzeit essen",
    "swap.keep.sugary": "Zuckerhaltige Snacks: mach weiter so âœ…",
    "swap.keep.drinks": "GesÃ¼ÃŸte GetrÃ¤nke: mach weiter so âœ…",
    "swap.keep.fastfood": "Fast Food / Burger: mach weiter so âœ…",
    "swap.keep.alcohol": "Alkohol: mach weiter so âœ…",
    "training.workouts": "Trainingseinheit(en)",
    "training.note.start": "Starte mit 3 Krafttrainingseinheiten pro Woche (einfaches GanzkÃ¶rpertraining).",
    "training.note.add1": "FÃ¼ge eine zusÃ¤tzliche Einheit pro Woche hinzu und achte auf Regeneration.",
    "training.note.maintain": "Bleibe bei etwa 5â€“6 Einheiten/Woche â€“ je nach Erholung.",
    "training.note.progress": "Behalte deinen aktuellen Plan bei und fokussiere dich auf Progression + Regeneration.",
    "steps.note.to10k": "Ziel: 10.000 Schritte pro Tag.",
    "steps.note.keep": "Du machst bereits 10.000+ Schritte/Tag. Mach weiter so âœ…",
    "steps.note.progress": "Woche 2: +1.000 Schritte/Tag. Danach: +1.000/Woche, bis du 10.000/Tag erreichst.",
    "sleep.note.keep": "Schlaf: mach weiter so. Versuche im Bereich 7â€“9 Stunden zu bleiben.",
    "sleep.note.add30": "Schlaf: Ziel 7â€“9 Stunden. FÃ¼r 2 Wochen: jede Woche +30 Minuten mehr im Bett.",
    "sleep.note.add45_60": "Schlaf: Ziel 7â€“9 Stunden. FÃ¼r 2 Wochen: jede Woche +45â€“60 Minuten mehr im Bett.",
    "sleep.note.aim": "Schlaf: wenn mÃ¶glich 7â€“9 Stunden anpeilen.",
    "recap.title": "Ergebnisse der ErnÃ¤hrungsanalyse",
    "recap.name": "Name",
    "recap.email": "E-Mail",
    "recap.country": "Land",
    "recap.age": "Alter",
    "recap.gender": "Geschlecht",
    "recap.height": "GrÃ¶ÃŸe",
    "recap.weight": "Gewicht",
    "recap.bodyFat": "KÃ¶rperfett",
    "recap.goal": "Ziel",
    "recap.activity": "AktivitÃ¤t",
    "recap.trainingNow": "Trainierst du aktuell",
    "recap.trainedBefore": "Schon frÃ¼her trainiert",
    "recap.trainingType": "Trainingsart",
    "recap.trainingDetails": "Trainingsdetails",
    "recap.stepsSleep": "Schritte | Schlaf",
    "recap.calories": "Kalorien",
    "recap.bmr": "Grundumsatz (BMR)",
    "recap.maintenance": "Erhalt",
    "recap.target": "Ziel",
    "recap.macros": "Makros",
    "goal.lose": "Fett verlieren",
    "goal.maintain": "Rekomposition (Fett verlieren / Muskeln aufbauen)",
    "goal.gain": "Muskelmasse aufbauen",
    "activity.sedentary": "Sitzend",
    "activity.light": "Leicht aktiv",
    "activity.moderate": "MÃ¤ÃŸig aktiv",
    "activity.very": "Sehr aktiv",
    "steps.none": "Sehr niedrig / nicht getrackt",
    "steps.2k": "~2.000/Tag",
    "steps.lt4k": "< 4.000/Tag",
    "steps.4to8k": "4.000â€“8.000/Tag",
    "steps.8to12k": "8.000â€“12.000/Tag",
    "steps.gt12k": "> 12.000/Tag",
    "sleep.lt4": "< 4 Std.",
    "sleep.4to6": "4â€“6 Std.",
    "sleep.6to8": "6â€“8 Std.",
    "sleep.8plus": "8 Std.+",
    "trainingType.strength": "Krafttraining / Gewichte",
    "trainingType.cardio": "Cardio / Ausdauer",
    "trainingType.mixed": "Gemischt",
    "trainingType.sport": "Sportspezifisch",
    "why.title": "Warum diese Werte?",
    "why.calories.title": "Kalorien",
    "why.calories.bmr": "BMR = Grundenergie",
    "why.calories.maintenance": "Erhalt = BMR Ã— AktivitÃ¤tsfaktor",
    "why.calories.goal": "Das Ziel verschiebt den Bedarf",
    "why.calories.lose": "FÃ¼r Fettverlust gehen wir unter den Erhalt, damit der KÃ¶rper gespeichertes Fett nutzt.",
    "why.calories.gain": "FÃ¼r Muskelaufbau gehen wir Ã¼ber den Erhalt, um Training und Regeneration zu unterstÃ¼tzen.",
    "why.calories.maintain": "FÃ¼r Rekomposition bleiben wir nahe am Erhalt, um die KÃ¶rperkomposition mit Training + Protein zu verbessern.",
    "why.protein.title": "Protein",
    "why.protein.text": "Basierend auf KÃ¶rpergewicht (KG) und angepasst an deinen KÃ¶rperfettanteil nach Standardrichtlinien.",
    "why.fat.title": "Fett",
    "why.fat.text": "Basierend auf deinem KÃ¶rperfettanteil (schlanker = etwas weniger, hÃ¶herer KFA = etwas mehr).",
    "why.carbs.title": "Kohlenhydrate",
    "why.carbs.text": "Restliche Kalorien zur UnterstÃ¼tzung von Training, Bewegung und Umsetzbarkeit.",
    "why.reminder": "Hinweis: Dies ist eine SchÃ¤tzung. Wenn du aktuell deutlich darunter isst, steigere langsam.",
    "btn.back": "ZurÃ¼ck",
    "btn.next": "Weiter",
    "btn.results": "Ergebnisse ansehen",
    "btn.restart": "Neu starten",
    "err.fill": "Bitte fÃ¼lle diese Felder aus:",
    "err.selectBf": "KÃ¶rperfett-SchÃ¤tzung",
    "cta.plan.title": "Willst du das in einen einfachen 12-Wochen-Plan umwandeln â€“ gemeinsam mit dir?",
    "cta.plan.btn": "Buche dein kostenloses 30-Min StrategiegesprÃ¤ch",
    "cta.community.title": "Noch nicht bereit fÃ¼r 1-1?",
    "cta.community.desc": "Tritt meiner kostenlosen Skool-Community bei â€“ mit Kursen zu ErnÃ¤hrung und KÃ¶rperrekomposition.",
    "cta.community.btn": "Kostenlose Coaching-Gruppe beitreten"
  }
};

const LANG_KEY = "nr_lang";

function t(key){
  const lang = getLang();
  return (I18N[lang] && I18N[lang][key]) || (I18N.en[key]) || key;
}

function getLang(){ return localStorage.getItem(LANG_KEY) || "en"; }

function setLang(lang){
  localStorage.setItem(LANG_KEY, lang);
  applyI18n();
  updateNavButtonText();
  if (currentStep === stepsEls.length - 1 && lastResultsData) renderResults(lastResultsData);
}

function applyI18n(){
  document.documentElement.lang = getLang();
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.innerHTML = t(el.getAttribute("data-i18n"));
  });
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    el.setAttribute("placeholder", t(el.getAttribute("data-i18n-placeholder")));
  });
}

function updateNavButtonText(){
  if (currentStep === stepsEls.length-1) nextBtn.textContent = t("btn.restart");
  else if (currentStep === stepsEls.length-2) nextBtn.textContent = t("btn.results");
  else nextBtn.textContent = t("btn.next");
  backBtn.textContent = t("btn.back");
}

/* =========================
   CALCULATION RULES
   ========================= */
const ACTIVITY_FACTOR = { sedentary: 1.2, light: 1.35, moderate: 1.55, very: 1.825 };
const GOAL_MULT = { lose: 0.80, maintain: 1.00, gain: 1.15 };

function round(n){ return Math.round(n); }
function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

function mifflinBMR({ gender, weightKg, heightCm, age }) {
  const base = 10 * weightKg + 6.25 * heightCm - 5 * age;
  return gender === "male" ? base + 5 : base - 161;
}

function bfMidpointPct(data){
  const min = Number(data.bfMin);
  const max = Number(data.bfMax);
  if (!isFinite(min) || !isFinite(max) || min <= 0 || max <= 0) return null;
  return (min + max) / 2;
}

function proteinFactorGPerKgBW(bfPct, gender){
  if (gender === "male") {
    if (bfPct <= 7) return 2.4; if (bfPct <= 10) return 2.4;
    if (bfPct <= 12) return 2.4; if (bfPct <= 15) return 2.2;
    if (bfPct <= 19) return 2.2; if (bfPct <= 24) return 2.0;
    if (bfPct <= 30) return 2.0; return 1.6;
  } else {
    if (bfPct <= 12) return 2.4; if (bfPct <= 17) return 2.4;
    if (bfPct <= 20) return 2.4; if (bfPct <= 23) return 2.2;
    if (bfPct <= 26) return 2.2; if (bfPct <= 29) return 2.0;
    if (bfPct <= 35) return 1.6; if (bfPct <= 40) return 1.6;
    return 1.6;
  }
}

function fatPctFromBF(bfPct, gender){
  if (gender === "male") {
    if (bfPct <= 7) return 0.225; if (bfPct <= 10) return 0.225;
    if (bfPct <= 12) return 0.225; if (bfPct <= 15) return 0.25;
    if (bfPct <= 19) return 0.25; if (bfPct <= 24) return 0.25;
    if (bfPct <= 30) return 0.30; return 0.30;
  } else {
    if (bfPct <= 12) return 0.225; if (bfPct <= 17) return 0.225;
    if (bfPct <= 20) return 0.25; if (bfPct <= 23) return 0.25;
    if (bfPct <= 26) return 0.25; if (bfPct <= 29) return 0.275;
    if (bfPct <= 35) return 0.275; if (bfPct <= 40) return 0.30;
    return 0.30;
  }
}

function computeTargets(data) {
  const bmr = mifflinBMR(data);
  const maintenance = bmr * (ACTIVITY_FACTOR[data.activity] ?? 1.2);
  const targetCalories = maintenance * (GOAL_MULT[data.goal] ?? 1.0);
  const bfPct = bfMidpointPct(data) ?? (data.gender === "female" ? 28 : 20);
  const pFactor = proteinFactorGPerKgBW(bfPct, data.gender);
  const proteinG = data.weightKg * pFactor;
  const fatPct = fatPctFromBF(bfPct, data.gender);
  const fatKcal = targetCalories * fatPct;
  const fatG = fatKcal / 9;
  const proteinKcal = proteinG * 4;
  const carbKcal = Math.max(0, targetCalories - proteinKcal - fatKcal);
  const carbsG = carbKcal / 4;
  return { bmr, maintenance, targetCalories, proteinG, carbsG, fatG, bfPct, fatPct, pFactor };
}

/* =========================
   MEAL IDEAS
   ========================= */
function getMealIdeas() {
  const lang = getLang();
  const MEAL_IDEAS_I18N = {
    en: {
      vegetarian: {
        breakfast: ["Greek yogurt, oats, blueberries, chia seeds, peanut butter","Eggs, spinach, mushrooms, whole-grain toast","Cottage cheese, banana, almond butter, cinnamon"],
        lunch: ["Lentils, quinoa, cucumber, cherry tomatoes, feta, olive oil","Halloumi cheese, mixed greens, roasted sweet potato","Chickpeas, tahini, lemon juice, parsley, whole-wheat pita"],
        dinner: ["Paneer cheese, tomato sauce, basmati rice, spices","Eggplant, lentils, garlic, olive oil","Ricotta cheese, zucchini, whole-wheat pasta"],
        snacks: ["Greek yogurt, almonds","Cheese slices, apple","Whey protein (animal-based), water, cinnamon"]
      },
      vegan: {
        breakfast: ["Tofu scramble, turmeric, bell peppers, onions, spinach","Rolled oats, soy milk, flaxseed, strawberries","Chickpea flour, water, cumin, scallions, olive oil"],
        lunch: ["Black beans, brown rice, avocado, cilantro, lime","Tempeh, broccoli, garlic, sesame oil","Hummus, roasted vegetables, whole-grain wrap"],
        dinner: ["Tofu, coconut milk, curry spices, spinach","Lentil pasta, homemade marinara sauce, mushrooms","Seitan, bell peppers, onions, tamari"],
        snacks: ["Roasted edamame","Peanut butter, rice cakes","Protein powder (plant-based: pea + rice blend), almond milk"]
      },
      omnivore: {
        breakfast: ["Eggs, smoked salmon, avocado, rye bread","Skyr yogurt, raspberries, walnuts","Egg whites, turkey bacon, tomatoes, sourdough"],
        lunch: ["Chicken breast, jasmine rice, green beans","Tuna, olive oil, mixed greens, chickpeas","Lean beef, roasted potatoes, carrots"],
        dinner: ["Salmon, lemon, asparagus, olive oil","Chicken breast, quinoa, roasted Brussels sprouts","Shrimp, garlic, olive oil, rice noodles"],
        snacks: ["Beef jerky","Hard-boiled eggs","Whey protein (animal-based), banana"]
      }
    },
    fr: {
      vegetarian: {
        breakfast: ["Yaourt grec, flocons d'avoine, myrtilles, graines de chia, beurre de cacahuÃ¨te","Å’ufs, Ã©pinards, champignons, pain complet grillÃ©","Fromage blanc, banane, purÃ©e d'amande, cannelle"],
        lunch: ["Lentilles, quinoa, concombre, tomates cerises, feta, huile d'olive","Halloumi, salade verte, patate douce rÃ´tie","Pois chiches, tahini, jus de citron, persil, pain pita complet"],
        dinner: ["Paneer, sauce tomate, riz basmati, Ã©pices","Aubergine, lentilles, ail, huile d'olive","Ricotta, courgette, pÃ¢tes complÃ¨tes"],
        snacks: ["Yaourt grec, amandes","Tranches de fromage, pomme","Whey protÃ©ine, eau, cannelle"]
      },
      vegan: {
        breakfast: ["Tofu brouillÃ©, curcuma, poivrons, oignons, Ã©pinards","Flocons d'avoine, lait de soja, graines de lin, fraises","Farine de pois chiches, eau, cumin, oignons verts, huile d'olive"],
        lunch: ["Haricots noirs, riz complet, avocat, coriandre, citron vert","Tempeh, brocoli, ail, huile de sÃ©same","Houmous, lÃ©gumes rÃ´tis, wrap complet"],
        dinner: ["Tofu, lait de coco, Ã©pices curry, Ã©pinards","PÃ¢tes aux lentilles, sauce marinara maison, champignons","Seitan, poivrons, oignons, tamari"],
        snacks: ["Edamame grillÃ©s","Beurre de cacahuÃ¨te, galettes de riz","ProtÃ©ine vÃ©gÃ©tale (pois + riz), lait d'amande"]
      },
      omnivore: {
        breakfast: ["Å’ufs, saumon fumÃ©, avocat, pain de seigle","Skyr, framboises, noix","Blancs d'Å“ufs, bacon de dinde, tomates, pain au levain"],
        lunch: ["Blanc de poulet, riz jasmin, haricots verts","Thon, huile d'olive, salade verte, pois chiches","BÅ“uf maigre, pommes de terre rÃ´ties, carottes"],
        dinner: ["Saumon, citron, asperges, huile d'olive","Blanc de poulet, quinoa, choux de Bruxelles rÃ´tis","Crevettes, ail, huile d'olive, nouilles de riz"],
        snacks: ["Viande sÃ©chÃ©e","Å’ufs durs","Whey protÃ©ine, banane"]
      }
    },
    de: {
      vegetarian: {
        breakfast: ["Griechischer Joghurt, Haferflocken, Blaubeeren, Chiasamen, Erdnussbutter","Eier, Spinat, Pilze, Vollkorntoast","HÃ¼ttenkÃ¤se, Banane, Mandelbutter, Zimt"],
        lunch: ["Linsen, Quinoa, Gurke, Kirschtomaten, Feta, OlivenÃ¶l","Halloumi, gemischter Salat, gerÃ¶stete SÃ¼ÃŸkartoffel","Kichererbsen, Tahini, Zitronensaft, Petersilie, Vollkorn-Pita"],
        dinner: ["Paneer, Tomatensauce, Basmatireis, GewÃ¼rze","Aubergine, Linsen, Knoblauch, OlivenÃ¶l","Ricotta, Zucchini, Vollkornnudeln"],
        snacks: ["Griechischer Joghurt, Mandeln","KÃ¤sescheiben, Apfel","Whey-Protein, Wasser, Zimt"]
      },
      vegan: {
        breakfast: ["Tofu-RÃ¼hrei, Kurkuma, Paprika, Zwiebeln, Spinat","Haferflocken, Sojamilch, Leinsamen, Erdbeeren","Kichererbsenmehl, Wasser, KreuzkÃ¼mmel, FrÃ¼hlingszwiebeln, OlivenÃ¶l"],
        lunch: ["Schwarze Bohnen, brauner Reis, Avocado, Koriander, Limette","Tempeh, Brokkoli, Knoblauch, SesamÃ¶l","Hummus, gerÃ¶stetes GemÃ¼se, Vollkorn-Wrap"],
        dinner: ["Tofu, Kokosmilch, CurrygewÃ¼rze, Spinat","Linsennudeln, hausgemachte Marinara-Sauce, Pilze","Seitan, Paprika, Zwiebeln, Tamari"],
        snacks: ["GerÃ¶stete Edamame","Erdnussbutter, Reiswaffeln","Pflanzliches Protein (Erbsen + Reis), Mandelmilch"]
      },
      omnivore: {
        breakfast: ["Eier, RÃ¤ucherlachs, Avocado, Roggenbrot","Skyr, Himbeeren, WalnÃ¼sse","EiweiÃŸ, Putenbacon, Tomaten, Sauerteigbrot"],
        lunch: ["HÃ¤hnchenbrust, Jasminreis, grÃ¼ne Bohnen","Thunfisch, OlivenÃ¶l, gemischter Salat, Kichererbsen","Mageres Rindfleisch, Bratkartoffeln, Karotten"],
        dinner: ["Lachs, Zitrone, Spargel, OlivenÃ¶l","HÃ¤hnchenbrust, Quinoa, gerÃ¶steter Rosenkohl","Garnelen, Knoblauch, OlivenÃ¶l, Reisnudeln"],
        snacks: ["Beef Jerky","Hartgekochte Eier","Whey-Protein, Banane"]
      }
    }
  };
  return MEAL_IDEAS_I18N[lang] || MEAL_IDEAS_I18N.en;
}

function normalizeWord(w){
  w = String(w || "").trim().toLowerCase();
  w = w.replace(/[^a-z0-9\s]/g, " ").replace(/\s+/g, " ").trim();
  if (w.endsWith("s") && w.length > 3) w = w.slice(0, -1);
  return w;
}

const FOOD_FAMILIES = {
  berries: ["strawberry","strawberries","blueberry","blueberries","raspberry","raspberries","blackberry","blackberries","cranberry","cranberries"],
  citrus: ["orange","oranges","lemon","lemons","lime","limes","grapefruit"],
  nuts: ["almond","almonds","walnut","walnuts","cashew","cashews","hazelnut","hazelnuts","pecan","pecans","pistachio","pistachios"]
};

function expandFoodNeedles(tokens){
  const expanded = new Set();
  tokens.forEach(tRaw => { const t = normalizeWord(tRaw); expanded.add(t); if (FOOD_FAMILIES[t]) FOOD_FAMILIES[t].forEach(x => expanded.add(normalizeWord(x))); });
  return Array.from(expanded);
}
function tokenizeCSV(text){ return String(text || "").split(",").map(normalizeWord).filter(Boolean); }
function splitMealParts(mealText){ return String(mealText || "").split(",").map(p => p.trim()).filter(Boolean); }

function containsAnyDislike(mealText, dislikes){
  const expanded = expandFoodNeedles(dislikes);
  const parts = splitMealParts(mealText).map(normalizeWord);
  if (expanded.includes("egg") && parts.some(p => p.includes("egg"))) return true;
  return parts.some(p => expanded.some(d => d && p.includes(d)));
}

function partHasAnyNeedle(part, needles){ const p = normalizeWord(part); return needles.some(n => n && p.includes(normalizeWord(n))); }

function sanitizeMealForAllergies(mealText, data){
  const allergies = data.allergies || [];
  let parts = splitMealParts(mealText);
  const hasGluten = allergies.includes("gluten"); const hasWheat = allergies.includes("wheat");
  if (hasGluten) parts = parts.map(applyGlutenFreeSwap);
  if (hasWheat) parts = parts.map(applyWheatFreeSwap);
  const produceNeedles = [];
  if ((allergies.includes("fruits") || allergies.includes("vegetables")) && data.produceAllergyDetails) {
    produceNeedles.push(...expandFoodNeedles(String(data.produceAllergyDetails).split(/[,/]/g).map(normalizeWord).filter(Boolean)));
  }
  const removeNeedles = [];
  if (allergies.includes("milk")) removeNeedles.push("yogurt","greek yogurt","skyr","cottage cheese","cheese","feta","ricotta","paneer","halloumi","milk");
  if (allergies.includes("egg")) removeNeedles.push("egg","eggs","egg whites","hard-boiled eggs");
  if (allergies.includes("soy")) removeNeedles.push("soy","soy milk","tofu","tempeh","edamame","tamari");
  if (allergies.includes("peanut")) removeNeedles.push("peanut","peanut butter");
  if (allergies.includes("treenuts")) removeNeedles.push("almond","almonds","almond butter","walnut","walnuts");
  if (allergies.includes("sesame")) removeNeedles.push("sesame","tahini");
  if (allergies.includes("fish")) removeNeedles.push("fish","salmon","smoked salmon","tuna");
  if (allergies.includes("shellfish")) removeNeedles.push("shrimp","shellfish");
  if (allergies.includes("fruits") || allergies.includes("vegetables")) removeNeedles.push(...produceNeedles);
  if (hasGluten) removeNeedles.push("seitan");
  const kept = parts.filter(part => !partHasAnyNeedle(part, removeNeedles));
  if (!kept.length) return null;
  return kept.join(", ");
}

function applyGlutenFreeSwap(part){
  let p = part;
  const swaps = [[/\bwhole[-\s]?wheat\s+pasta\b/i,"gluten-free pasta"],[/\bpasta\b/i,"gluten-free pasta"],[/\bwhole[-\s]?wheat\s+wrap\b/i,"gluten-free wrap"],[/\bwrap\b/i,"gluten-free wrap"],[/\bpita\b/i,"gluten-free pita"],[/\bwhole[-\s]?grain\s+toast\b/i,"gluten-free toast"],[/\btoast\b/i,"gluten-free toast"],[/\bsourdough\b/i,"gluten-free sourdough"],[/\brye\s+bread\b/i,"gluten-free bread"],[/\brye\b/i,"gluten-free bread"],[/\bbread\b/i,"gluten-free bread"],[/\brolled\s+oats\b/i,"gluten-free oats"],[/\boats\b/i,"gluten-free oats"],[/\btamari\b/i,"gluten-free tamari"],[/\bsoy\s+sauce\b/i,"gluten-free soy sauce"]];
  for (const [re, rep] of swaps) { if (re.test(p)) p = p.replace(re, rep); }
  return p;
}

function applyWheatFreeSwap(part){
  let p = part;
  const swaps = [[/\bwhole[-\s]?wheat\s+pasta\b/i,"rice pasta"],[/\bpasta\b/i,"rice pasta"],[/\bwhole[-\s]?wheat\s+wrap\b/i,"corn tortilla"],[/\bwrap\b/i,"corn tortilla"],[/\bpita\b/i,"corn tortilla"],[/\bwhole[-\s]?grain\s+toast\b/i,"wheat-free toast"],[/\btoast\b/i,"wheat-free toast"],[/\bsourdough\b/i,"wheat-free sourdough"],[/\brye\s+bread\b/i,"wheat-free bread"],[/\brye\b/i,"wheat-free bread"],[/\bbread\b/i,"wheat-free bread"],[/\brolled\s+oats\b/i,"certified wheat-free oats"],[/\boats\b/i,"certified wheat-free oats"]];
  for (const [re, rep] of swaps) { if (re.test(p)) p = p.replace(re, rep); }
  return p;
}

function pickN(arr, n){
  const copy = arr.slice();
  for (let i=copy.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [copy[i], copy[j]] = [copy[j], copy[i]]; }
  return copy.slice(0, Math.min(n, copy.length));
}

function buildMealIdeas(data){
  const dislikes = tokenizeCSV(data.dislikes);
  const MEAL_IDEAS = getMealIdeas();
  const ideas = MEAL_IDEAS[data.diet] || MEAL_IDEAS.omnivore;
  const cleanList = (list) => list.filter(x => !containsAnyDislike(x, dislikes)).map(x => sanitizeMealForAllergies(x, data)).filter(Boolean);
  const breakfast = cleanList(ideas.breakfast); const lunch = cleanList(ideas.lunch);
  const dinner = cleanList(ideas.dinner); const snacks = cleanList(ideas.snacks);
  return { breakfast: pickN(breakfast, 2), lunch: pickN(lunch, 2), dinner: pickN(dinner, 2), snacks: pickN(snacks, 2), empty: (!breakfast.length && !lunch.length && !dinner.length && !snacks.length) };
}

/* =========================
   ACTION PLAN
   ========================= */
function habitPerWeek(v){
  if (v==="none") return 0; if (v==="1") return 1; if (v==="2") return 2;
  if (v==="3-4") return 3.5; if (v==="3-5") return 4; if (v==="5+") return 5.5;
  if (v==="daily") return 7; return 0;
}

function progressiveCutLabel(itemName, n){
  if (n <= 0) return null;
  let week1 = n, week2 = n;
  if (n === 1) { week1 = 1; week2 = 1; }
  else if (n === 2) { week1 = 1; week2 = 1; }
  else if (n > 2 && n <= 5) { week1 = 2; week2 = 1; }
  else if (n > 5) { week1 = 3; week2 = 2; }
  return { key: itemName, week1, week2 };
}

function trainingProgression(data){
  if (data.trainingNow === "no" && (data.trainedBefore === "no" || !data.trainedBefore)) return { week1: 3, week2: 3, noteKey: "training.note.start" };
  const sessions = data.sessionsPerWeek || "0";
  if (sessions === "0" || sessions === "1-2" || sessions === "" || sessions == null) return { week1: 3, week2: 3, noteKey: "training.note.start" };
  if (sessions === "3") return { week1: 4, week2: 4, noteKey: "training.note.add1" };
  if (sessions === "4") return { week1: 5, week2: 5, noteKey: "training.note.add1" };
  if (sessions === "5-6") return { week1: 5, week2: 6, noteKey: "training.note.maintain" };
  return { week1: 6, week2: 6, noteKey: "training.note.progress" };
}

function baseStepsFromBand(band){
  if (band==="none") return 2000; if (band==="2k") return 2000; if (band==="lt4k") return 3000;
  if (band==="4to8k") return 6000; if (band==="8to12k") return 9000; if (band==="gt12k") return 12000; return 6000;
}

function stepPlan(stepsBand){
  if (stepsBand === "8to12k") return { mode: "to10k", noteKey: "steps.note.to10k" };
  const start = baseStepsFromBand(stepsBand);
  if (start >= 10000) return { mode: "keep", noteKey: "steps.note.keep" };
  return { mode: "progress", week1: start, week2: Math.min(10000, start + 1000), noteKey: "steps.note.progress", showLongTerm: true };
}

function sleepAdvice(sleepBand){
  if (sleepBand === "6to8" || sleepBand === "8plus") return { noteKey: "sleep.note.keep" };
  if (sleepBand === "4to6") return { noteKey: "sleep.note.add30" };
  if (sleepBand === "lt4") return { noteKey: "sleep.note.add45_60" };
  return { noteKey: "sleep.note.aim" };
}

function swapsForHabits(data){
  const swaps = [];
  if (habitPerWeek(data.snacks) > 0) swaps.push("swap.sweet","swap.chocolate","swap.cookies","swap.dessert");
  else swaps.push("swap.keep.sugary");
  if (habitPerWeek(data.sodas) > 0) swaps.push("swap.soda","swap.sweetDrink","swap.energy");
  else swaps.push("swap.keep.drinks");
  if (habitPerWeek(data.fastfood) > 0) swaps.push("swap.fastfood","swap.burger","swap.notime");
  else swaps.push("swap.keep.fastfood");
  if (habitPerWeek(data.alcohol) > 0) swaps.push("swap.alc.limit","swap.alc.water","swap.alc.meal");
  else swaps.push("swap.keep.alcohol");
  return swaps;
}

function goalLabelI18n(goal){
  if (goal === "lose") return t("results.target.lose");
  if (goal === "gain") return t("results.target.gain");
  return t("results.target.maintain");
}

function buildWhyText(data, targets){
  const g = t("goal." + (data.goal || "maintain"));
  const whyCalories = data.goal === "lose" ? t("why.calories.lose") : data.goal === "gain" ? t("why.calories.gain") : t("why.calories.maintain");
  return `${t("why.title")}\n\nâ€¢ ${t("why.calories.title")}:\n  - ${t("why.calories.bmr")}\n  - ${t("why.calories.maintenance")}\n  - ${t("why.calories.goal")} (${g})\n  - ${whyCalories}\n\nâ€¢ ${t("why.protein.title")}:\n  - ${t("why.protein.text")}\n\nâ€¢ ${t("why.fat.title")}:\n  - ${t("why.fat.text")}\n\nâ€¢ ${t("why.carbs.title")}:\n    - ${t("why.carbs.text")}\n\n${t("why.reminder")}`;
}

function getCountryName(code) {
  const sel = document.getElementById("country");
  if (!sel) return code || "-";
  const opt = sel.querySelector(`option[value="${code}"]`);
  return opt ? opt.textContent : (code || "-");
}

function buildResultsText(data, targets){
  const goalKey = data.goal || "maintain";
  const activityKey = data.activity || "moderate";
  const stepsKey = data.steps || "none";
  const sleepKey = data.sleep || "6to8";
  
  return `${t("recap.title")}

${t("recap.name")}: ${data.firstName || "-"}
${t("recap.email")}: ${data.userEmail || "-"}
${t("recap.country")}: ${getCountryName(data.country)}
${t("recap.age")}: ${data.age || "-"} | ${t("recap.gender")}: ${data.gender === "male" ? t("s1.gender.male") : data.gender === "female" ? t("s1.gender.female") : "-"}
${t("recap.height")}: ${data.heightCm || "-"} cm | ${t("recap.weight")}: ${data.weightKg || "-"} kg
${t("recap.bodyFat")}: ${data.bfRangeLabel || "-"} (~${Math.round(targets.bfPct)}%)
${t("recap.goal")}: ${t("goal." + goalKey)}
${t("recap.activity")}: ${t("activity." + activityKey)}
${t("recap.trainingNow")}: ${data.trainingNow === "yes" ? t("common.yes") : t("common.no")}
${t("recap.trainedBefore")}: ${data.trainedBefore ? (data.trainedBefore === "yes" ? t("common.yes") : t("common.no")) : "-"}
${t("recap.trainingType")}: ${data.trainingType ? t("trainingType." + data.trainingType) : "-"}
${t("recap.trainingDetails")}: ${data.trainingDetails || "-"}
${t("recap.stepsSleep")}: ${t("steps." + stepsKey)} | ${t("sleep." + sleepKey)}

${t("recap.calories")}:
- ${t("recap.bmr")}: ${Math.round(targets.bmr)} kcal/day
- ${t("recap.maintenance")}: ${Math.round(targets.maintenance)} kcal/day
- ${t("recap.target")}: ${Math.round(targets.targetCalories)} kcal/day

${t("recap.macros")}:
- ${t("results.protein")}: ${Math.round(targets.proteinG)} g/day
- ${t("results.carbs")}: ${Math.round(targets.carbsG)} g/day
- ${t("results.fats")}: ${Math.round(targets.fatG)} g/day
`;
}

function escapeHtml(s){
  return String(s || "").replace(/[&<>"']/g, (c)=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[c]));
}

/* =========================
   DONUT CHARTS (SVG)
   ========================= */
function pctRound(x){ return Math.max(0, Math.round(x)); }

function donutSVG(pctProtein, pctCarbs, pctFats){
  const r = 44; const c = 2 * Math.PI * r;
  const p1 = (pctProtein/100) * c; const p2 = (pctCarbs/100) * c; const p3 = (pctFats/100) * c;
  return `
  <svg width="120" height="120" viewBox="0 0 120 120" aria-label="macro donut">
    <circle cx="60" cy="60" r="${r}" fill="none" stroke="rgba(255,255,255,.10)" stroke-width="16" />
    <circle cx="60" cy="60" r="${r}" fill="none" stroke="var(--protein)" stroke-width="16" stroke-dasharray="${p1} ${c-p1}" stroke-dashoffset="0" transform="rotate(-90 60 60)" />
    <circle cx="60" cy="60" r="${r}" fill="none" stroke="var(--carbs)" stroke-width="16" stroke-dasharray="${p2} ${c-p2}" stroke-dashoffset="${-p1}" transform="rotate(-90 60 60)" />
    <circle cx="60" cy="60" r="${r}" fill="none" stroke="var(--fats)" stroke-width="16" stroke-dasharray="${p3} ${c-p3}" stroke-dashoffset="${-(p1+p2)}" transform="rotate(-90 60 60)" />
    <circle cx="60" cy="60" r="30" fill="rgba(9,14,28,.95)" />
    <text x="60" y="64" text-anchor="middle" font-size="10" fill="rgba(234,242,255,.9)" font-weight="800">Macros</text>
  </svg>`;
}

/* =========================
   RESULTS RENDER
   ========================= */
function renderResults(data){
  const resultsEl = document.getElementById("results");
  const targets = computeTargets(data);

  trackToGoogleSheets('completed', 3, {
    targetCalories: Math.round(targets.targetCalories),
    proteinG: Math.round(targets.proteinG),
    carbsG: Math.round(targets.carbsG),
    fatG: Math.round(targets.fatG)
  });

  const cuts = [];
  const s1 = progressiveCutLabel("cut.sugary", habitPerWeek(data.snacks));
  const s2 = progressiveCutLabel("cut.drinks", habitPerWeek(data.sodas));
  const s3 = progressiveCutLabel("cut.fastfood", habitPerWeek(data.fastfood));
  const s4 = progressiveCutLabel("cut.alcohol", habitPerWeek(data.alcohol));
  [s1,s2,s3,s4].forEach(x => { if (x) cuts.push(x); });

  const train = trainingProgression(data);
  const steps = stepPlan(data.steps);
  const sleep = sleepAdvice(data.sleep);
  const swaps = swapsForHabits(data);
  const meals = buildMealIdeas(data);
  const whyText = buildWhyText(data, targets);
  const resultsText = buildResultsText(data, targets);

  const pK = targets.proteinG * 4; const cK = targets.carbsG * 4; const fK = targets.fatG * 9;
  const totalK = Math.max(1, pK + cK + fK);
  const pctPk = (pK/totalK)*100; const pctCk = (cK/totalK)*100; const pctFk = (fK/totalK)*100;
  const donut = donutSVG(pctRound(pctPk), pctRound(pctCk), pctRound(pctFk));

  const cutsHtml = cuts.length
    ? cuts.map(c => `<li><b>${escapeHtml(t(c.key))}:</b><br/>${escapeHtml(t("week.1"))}: <b>${c.week1}</b> ${escapeHtml(t("timesPerWeek"))}<br/>${escapeHtml(t("week.2"))}: <b>${c.week2}</b> ${escapeHtml(t("timesPerWeek"))}</li>`).join("")
    : "";

  const ctaBlockHtml = `
    <div class="ctaBox">
      <div class="ctaItem">
        <div class="ctaTitle">${t("cta.plan.title")}</div>
        <a href="https://calendly.com/letzroar-info/game-plan-call" class="ctaBtn ctaPrimary cta-calendly" target="_blank" data-cta="calendly">${t("cta.plan.btn")} â†’</a>
      </div>
      <div class="ctaDivider"></div>
      <div class="ctaItem">
        <div class="ctaTitle">${t("cta.community.title")}</div>
        <div class="ctaDesc">${t("cta.community.desc")}</div>
        <a href="https://www.skool.com/fitness-transformation-8222/classroom" class="ctaBtn ctaSecondary cta-skool" target="_blank" data-cta="skool">${t("cta.community.btn")} â†’</a>
      </div>
    </div>
  `;

  // Build the send results + summary block as a reusable string
  const sendResultsBlockHtml = `
    <h2>${t("results.send")}</h2>
    <div class="field" style="margin-top:6px;">
      <label class="check" style="padding:10px 12px;border:1px solid rgba(255,255,255,.10);border-radius:14px;background:rgba(255,255,255,.04);">
        <input type="checkbox" class="sendMeResultsCheckbox" />
        ${t("results.send.yes")}
      </label>
    </div>

    <div class="contactBlockInstance" style="display:none">
      <div class="row">
        <div class="field">
          <label>${t("contact.email")}</label>
          <input type="email" class="emailInputField" placeholder="name@email.com" />
        </div>
        <div class="field">
          <label>${t("contact.phone")}</label>
          <input type="tel" class="phoneInputField" placeholder="+33 6 12 34 56 78" />
        </div>
      </div>
      <div class="btnrow" style="border-top:none;padding-top:0;">
        <button type="button" class="ghost mini emailBtnAction">${t("contact.sendEmail")}</button>
        <button type="button" class="primary mini waBtnAction">${t("contact.sendWhatsApp")}</button>
      </div>
      <p class="note">${t("contact.note")}</p>
    </div>
  `;

  resultsEl.innerHTML = `
    <div class="warn">
      <b>${t("results.notice.title")}</b> ${t("results.notice.text")}
    </div>

    <div class="adjustNote">
      ${t("results.adjust.note")}
    </div>

    <h2>${t("results.bodyComp")}</h2>
    <div class="grid2">
      <div class="kpi">
        <div class="small">${t("results.bfRange")}</div>
        <b>${escapeHtml(data.bfRangeLabel || "-")}</b>
      </div>
      <div class="kpi">
        <div class="small">${t("results.bfMidpoint")}</div>
        <b>${Math.round(targets.bfPct)}%</b>
      </div>
    </div>

    <h2>${t("results.calories")}</h2>
    <div class="grid2">
      <div class="kpi">
        <div class="small">${t("results.bmr")}</div>
        <b>${round(targets.bmr)} kcal/day</b>
      </div>
      <div class="kpi">
        <div class="small">${t("results.maintenance")}</div>
        <b>${round(targets.maintenance)} kcal/day</b>
      </div>
      <div class="kpi target span2">
        <div class="small">${escapeHtml(goalLabelI18n(data.goal))}</div>
        <b>${round(targets.targetCalories)} kcal/day</b>
      </div>
    </div>

    <div class="drop" id="moreDrop">
      <div class="dropHead" id="moreBtn">
        ${t("results.more")} <span style="opacity:.8;font-weight:900" id="caret">â–¾</span>
      </div>
      <div class="dropBody"><pre class="mono">${escapeHtml(whyText)}</pre></div>
    </div>

    <h2>${t("results.macros")}</h2>
    <div>
      <span class="pill protein"><b>${t("results.protein")}</b> ${round(targets.proteinG)} g/day</span>
      <span class="pill carbs"><b>${t("results.carbs")}</b> ${round(targets.carbsG)} g/day</span>
      <span class="pill fats"><b>${t("results.fats")}</b> ${round(targets.fatG)} g/day</span>
      <div class="note">${t("results.macros.note").replace("{pf}", targets.pFactor.toFixed(1)).replace("{fat}", String(Math.round(targets.fatPct*100)))}</div>
    </div>

    <div class="donutRow">
      <div class="donutCard">
        <div class="donutHead"><b>${t("results.macro.chart.grams")}</b><span>${t("results.gramsDay")}</span></div>
        <div class="donutWrap">
          ${donut}
          <div class="legend">
            <div class="legItem"><span class="swatch swProtein"></span> ${t("results.protein")}: ${round(targets.proteinG)} g</div>
            <div class="legItem"><span class="swatch swCarbs"></span> ${t("results.carbs")}: ${round(targets.carbsG)} g</div>
            <div class="legItem"><span class="swatch swFats"></span> ${t("results.fats")}: ${round(targets.fatG)} g</div>
            <div class="note">${t("results.donutNote")}</div>
          </div>
        </div>
      </div>
      <div class="donutCard">
        <div class="donutHead"><b>${t("results.macro.chart.calories")}</b><span>${t("results.pctCalories")}</span></div>
        <div class="donutWrap">
          ${donut}
          <div class="legend">
            <div class="legItem"><span class="swatch swProtein"></span> ${t("results.protein")}: ${round(pK)} kcal (${pctRound(pctPk)}%)</div>
            <div class="legItem"><span class="swatch swCarbs"></span> ${t("results.carbs")}: ${round(cK)} kcal (${pctRound(pctCk)}%)</div>
            <div class="legItem"><span class="swatch swFats"></span> ${t("results.fats")}: ${round(fK)} kcal (${pctRound(pctFk)}%)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- FIRST CTA BLOCK - After macros -->
    ${ctaBlockHtml}

    <div class="hr"></div>

    <!-- FIRST send results block -->
    ${sendResultsBlockHtml}

    <div class="hr"></div>

    <div class="mealsBox">
      <div class="mealsTitle">
        <span>${t("results.mealIdeas.tag")}</span> ${t("results.meals")}
      </div>
      ${meals.empty ? `<div class="help">${t("results.noMealsMatch")}</div>` : `
        <b>${t("results.breakfast")}:</b>
        <ul class="list">${meals.breakfast.length ? meals.breakfast.map(m=>`<li>${escapeHtml(m)}</li>`).join("") : `<li>${t("results.noOptions")}</li>`}</ul>
        <b>${t("results.lunch")}:</b>
        <ul class="list">${meals.lunch.length ? meals.lunch.map(m=>`<li>${escapeHtml(m)}</li>`).join("") : `<li>${t("results.noOptions")}</li>`}</ul>
        <b>${t("results.dinner")}:</b>
        <ul class="list">${meals.dinner.length ? meals.dinner.map(m=>`<li>${escapeHtml(m)}</li>`).join("") : `<li>${t("results.noOptions")}</li>`}</ul>
        <b>${t("results.snack")}:</b>
        <ul class="list">${meals.snacks.length ? meals.snacks.map(m=>`<li>${escapeHtml(m)}</li>`).join("") : `<li>${t("results.noOptions")}</li>`}</ul>
      `}
    </div>

    <div class="hr"></div>

    <h2>${t("results.action.title")}</h2>

    <h2 style="margin-top:10px">${t("results.action.cut")}</h2>
    ${cuts.length ? `<ul class="list">${cutsHtml}</ul>` : `<div class="help">${t("swap.keep.sugary")}</div>`}

    <h2>${t("results.action.swaps")}</h2>
    <ul class="list">${swaps.map(k=>`<li>${escapeHtml(t(k))}</li>`).join("")}</ul>

    <h2>${t("results.action.training")}</h2>
    <p class="note">${escapeHtml(t(train.noteKey))}</p>
    <ul class="list">
      <li><b>${t("week.1")}:</b> ${train.week1} ${t("training.workouts")}</li>
      <li><b>${t("week.2")}:</b> ${train.week2} ${t("training.workouts")}</li>
    </ul>

    <h2>${t("results.action.steps")}</h2>
    ${steps.mode === "keep" ? `<div class="help">${escapeHtml(t(steps.noteKey))}</div>`
      : steps.mode === "to10k" ? `<div class="help">${escapeHtml(t(steps.noteKey))}</div>`
      : `<p class="note">${escapeHtml(t(steps.noteKey))}</p>
      <ul class="list">
        <li><b>${t("week.1")}:</b> ${t("results.action.steps.aim")} <b>${steps.week1.toLocaleString()}</b> ${t("results.action.steps.perday")}</li>
        <li><b>${t("week.2")}:</b> ${t("results.action.steps.aim")} <b>${steps.week2.toLocaleString()}</b> ${t("results.action.steps.perday")}</li>
        ${steps.showLongTerm ? `<li><b>${t("results.action.steps.after")}:</b> ${t("results.action.steps.add1k")}</li>` : ``}
      </ul>`
    }

    <h2>${t("results.sleep")}</h2>
    <div class="help">${escapeHtml(t(sleep.noteKey))}</div>

    <!-- SECOND CTA BLOCK - After sleep -->
    ${ctaBlockHtml}

    <div class="hr"></div>

    <!-- FIRST send results + summary block -->
    ${sendResultsBlockHtml}

    <div class="hr"></div>

    <h2>${t("results.summary")}</h2>
    <div class="help"><pre class="mono">${escapeHtml(resultsText)}</pre></div>
  `;

  // dropdown
  const drop = document.getElementById("moreDrop");
  const head = document.getElementById("moreBtn");
  const caret = document.getElementById("caret");
  head.addEventListener("click", ()=>{
    drop.classList.toggle("open");
    caret.textContent = drop.classList.contains("open") ? "â–´" : "â–¾";
  });

  // Track CTA link clicks
  document.querySelectorAll('.cta-calendly').forEach(link => {
    link.addEventListener('click', () => { trackCtaClick('calendly'); });
  });
  document.querySelectorAll('.cta-skool').forEach(link => {
    link.addEventListener('click', () => { trackCtaClick('skool'); });
  });

  // Wire up ALL send results checkbox + contact blocks (supports multiple instances)
  const allCheckboxes = document.querySelectorAll('.sendMeResultsCheckbox');
  const allContactBlocks = document.querySelectorAll('.contactBlockInstance');

  allCheckboxes.forEach((cb, idx) => {
    const contactBlock = allContactBlocks[idx];
    if (!contactBlock) return;

    cb.addEventListener("change", () => {
      contactBlock.style.display = cb.checked ? "" : "none";
      // Sync all checkboxes
      allCheckboxes.forEach(otherCb => { otherCb.checked = cb.checked; });
      allContactBlocks.forEach(otherBlock => { otherBlock.style.display = cb.checked ? "" : "none"; });
      
      if (cb.checked) {
        ctaClicks.sendResultsChecked = true;
        trackToGoogleSheets('send_results_checked', currentStep);
        contactBlock.scrollIntoView({ behavior:"smooth", block:"start" });
      }
    });
  });

  // Wire up ALL email/phone inputs and send buttons
  const allEmailInputs = document.querySelectorAll('.emailInputField');
  const allPhoneInputs = document.querySelectorAll('.phoneInputField');
  const allEmailBtns = document.querySelectorAll('.emailBtnAction');
  const allWaBtns = document.querySelectorAll('.waBtnAction');

  // Sync email inputs across instances
  allEmailInputs.forEach(input => {
    const trackEmailDebounced = debounce(() => {
      const email = input.value.trim();
      if (email && email.includes('@')) {
        trackContactInfo('email', email);
        // Sync to other instances
        allEmailInputs.forEach(other => { if (other !== input) other.value = input.value; });
      }
    }, 1500);
    input.addEventListener('input', trackEmailDebounced);
    input.addEventListener('blur', () => {
      const email = input.value.trim();
      if (email && email.includes('@')) {
        trackContactInfo('email', email);
        allEmailInputs.forEach(other => { if (other !== input) other.value = input.value; });
      }
    });
  });

  // Sync phone inputs across instances
  allPhoneInputs.forEach(input => {
    const trackPhoneDebounced = debounce(() => {
      const phone = input.value.trim();
      if (phone && phone.length >= 8) {
        trackContactInfo('phone', phone);
        allPhoneInputs.forEach(other => { if (other !== input) other.value = input.value; });
      }
    }, 1500);
    input.addEventListener('input', trackPhoneDebounced);
    input.addEventListener('blur', () => {
      const phone = input.value.trim();
      if (phone && phone.length >= 8) {
        trackContactInfo('phone', phone);
        allPhoneInputs.forEach(other => { if (other !== input) other.value = input.value; });
      }
    });
  });

  // Email send buttons
  allEmailBtns.forEach((btn, idx) => {
    btn.addEventListener("click", () => {
      // Get email from the closest input in the same contact block
      const parentBlock = btn.closest('.contactBlockInstance');
      const emailInput = parentBlock ? parentBlock.querySelector('.emailInputField') : allEmailInputs[0];
      const email = emailInput ? emailInput.value.trim() : "";
      if (!email) { alert("Please enter your email."); return; }
      userContactInfo.email = email;
      ctaClicks.sendEmail = true;
      trackToGoogleSheets('send_email_clicked', currentStep, { contactEmail: email });
      const subject = encodeURIComponent("Your Nutrition Assessment Results");
      const body = encodeURIComponent(resultsText);
      window.location.href = `mailto:${encodeURIComponent(email)}?subject=${subject}&body=${body}`;
    });
  });

  // WhatsApp send buttons
  allWaBtns.forEach((btn, idx) => {
    btn.addEventListener("click", () => {
      const parentBlock = btn.closest('.contactBlockInstance');
      const phoneInput = parentBlock ? parentBlock.querySelector('.phoneInputField') : allPhoneInputs[0];
      let phone = phoneInput ? phoneInput.value.trim() : "";
      if (!phone) { alert("Please enter your phone number."); return; }
      userContactInfo.phone = phone;
      ctaClicks.sendWhatsApp = true;
      trackToGoogleSheets('send_whatsapp_clicked', currentStep, { contactPhone: phone });
      phone = phone.replace(/[^\d]/g, "");
      if (phone.length < 8) { alert("Please enter a valid phone number in international format."); return; }
      const msg = encodeURIComponent(resultsText);
      window.open(`https://wa.me/${phone}?text=${msg}`, "_blank");
    });
  });

  // Pre-fill email from quiz if provided
  const quizEmail = data.userEmail || "";
  if (quizEmail) {
    allEmailInputs.forEach(input => { input.value = quizEmail; });
  }
}

/* =========================
   VALIDATION + DYNAMIC FIELDS
   ========================= */
function setVisible(id, on){
  const el = document.getElementById(id);
  if (!el) return;
  el.style.display = on ? "" : "none";
}

function scrollToElementTop(el) { el.scrollIntoView({ behavior: "smooth", block: "start" }); }

function clearInvalidMarks(stepEl) {
  stepEl.querySelectorAll(".invalid").forEach(x => x.classList.remove("invalid"));
  stepEl.querySelectorAll(".invalid-label").forEach(x => x.classList.remove("invalid-label"));
  const bfGrid = document.getElementById("bfGrid");
  if (bfGrid) bfGrid.classList.remove("invalidGrid");
}

function markFieldInvalid(el) {
  el.classList.add("invalid");
  const fieldWrap = el.closest(".field");
  if (fieldWrap) { const lab = fieldWrap.querySelector("label"); if (lab) lab.classList.add("invalid-label"); }
  if (el && (el.id === "bfMin" || el.id === "bfMax" || el.id === "bfRangeLabel")) {
    const grid = document.getElementById("bfGrid"); if (grid) grid.classList.add("invalidGrid");
  }
}

function showErrorBanner(missingLabels){
  const b = document.getElementById("errBanner");
  if (!missingLabels.length){ b.style.display = "none"; b.innerHTML = ""; return; }
  b.style.display = "block";
  b.innerHTML = `<b>${escapeHtml(t("err.fill"))}</b> ${missingLabels.map(x=>`<span style="white-space:nowrap"> â€¢ ${escapeHtml(x)}</span>`).join("")}`;
}

function getCheckedAllergies(){ return Array.from(document.querySelectorAll('input[name="allergies"]:checked')).map(x => x.value); }

function updateTrainingFields(){
  const trainingNow = document.getElementById("trainingNow").value;
  const trainedBefore = document.getElementById("trainedBefore").value;
  const type = document.getElementById("trainingType").value;
  setVisible("trainedBeforeWrap", trainingNow === "no");
  const showType = (trainingNow === "yes") || (trainingNow === "no" && trainedBefore === "yes");
  setVisible("trainingTypeWrap", showType);
  const showSessions = (trainingNow === "yes");
  setVisible("sessionsWrap", showSessions);
  if (!showSessions) document.getElementById("sessionsPerWeek").value = "0";
  const showDetails = showType && (type === "mixed" || type === "sport");
  setVisible("trainingDetailsWrap", showDetails);
  if (!showType) { document.getElementById("trainingType").value = ""; document.getElementById("trainingDetails").value = ""; }
  if (!showDetails) document.getElementById("trainingDetails").value = "";
}

function updateProduceAllergyField(){
  const allergies = getCheckedAllergies();
  setVisible("produceAllergyWrap", allergies.includes("fruits") || allergies.includes("vegetables"));
}

function updateCurrentCalsRequired(){
  const tracks = document.getElementById("tracks").value;
  const currentCals = document.getElementById("currentCals");
  const currentCalsLabel = currentCals.closest(".field").querySelector("label");
  if (tracks === "sometimes" || tracks === "yes") {
    currentCals.required = true;
    currentCalsLabel.setAttribute("data-i18n", "s2.currentCals.required");
    currentCalsLabel.innerHTML = t("s2.currentCals.required");
  } else {
    currentCals.required = false;
    currentCalsLabel.setAttribute("data-i18n", "s2.currentCals");
    currentCalsLabel.innerHTML = t("s2.currentCals");
  }
}

function validateStep(i){
  const step = document.getElementById(`step-${i}`);
  clearInvalidMarks(step);
  const required = Array.from(step.querySelectorAll("[required]"));
  let firstInvalid = null;
  const missingLabels = [];

  for (const el of required) {
    if (!el.value) {
      if (!firstInvalid) firstInvalid = el;
      markFieldInvalid(el);
      const wrap = el.closest(".field");
      const lab = wrap ? wrap.querySelector("label") : null;
      if (el.id === "bfMin" || el.id === "bfMax" || el.id === "bfRangeLabel") {
        if (!missingLabels.includes(t("err.selectBf"))) missingLabels.push(t("err.selectBf"));
      } else {
        missingLabels.push(lab ? lab.textContent.trim() : "Missing field");
      }
    }
  }

  const tdWrap = document.getElementById("trainingDetailsWrap");
  if (tdWrap && tdWrap.style.display !== "none") {
    const td = document.getElementById("trainingDetails");
    if (!td.value) { if (!firstInvalid) firstInvalid = td; markFieldInvalid(td); missingLabels.push(t("s1.trainingDetails")); }
  }

  const pWrap = document.getElementById("produceAllergyWrap");
  if (pWrap && pWrap.style.display !== "none") {
    const pd = document.getElementById("produceAllergyDetails");
    if (!pd.value) { if (!firstInvalid) firstInvalid = pd; markFieldInvalid(pd); missingLabels.push(t("s3.produce.details")); }
  }

  if (firstInvalid) {
    showErrorBanner(missingLabels);
    scrollToElementTop(firstInvalid);
    firstInvalid.focus({ preventScroll: true });
    return false;
  }
  showErrorBanner([]);
  return true;
}

/* =========================
   BODY FAT VISUAL CARDS
   ========================= */
function initBfVisualCards(){
  const grid = document.getElementById("bfGrid");
  const prompt = document.getElementById("bfPrompt");
  const bfMinEl = document.getElementById("bfMin");
  const bfMaxEl = document.getElementById("bfMax");
  const bfLabelEl = document.getElementById("bfRangeLabel");
  if (!grid || !bfMinEl || !bfMaxEl || !bfLabelEl) return;
  const cards = Array.from(grid.querySelectorAll(".bfCard"));

  function clearSelection(){
    bfMinEl.value = ""; bfMaxEl.value = ""; bfLabelEl.value = "";
    cards.forEach(c => { c.classList.remove("isSelected"); c.setAttribute("aria-checked", "false"); });
  }

  function setSelection(card){
    bfMinEl.value = String(card.dataset.min || "");
    bfMaxEl.value = String(card.dataset.max || "");
    bfLabelEl.value = String(card.dataset.label || "");
    grid.classList.remove("invalidGrid");
    bfMinEl.classList.remove("invalid"); bfMaxEl.classList.remove("invalid"); bfLabelEl.classList.remove("invalid");
    const wrap = bfMinEl.closest(".field");
    if (wrap){ const lab = wrap.querySelector("label"); if (lab) lab.classList.remove("invalid-label"); }
    cards.forEach(c => { const on = c === card; c.classList.toggle("isSelected", on); c.setAttribute("aria-checked", on ? "true" : "false"); });
    trackFieldChange();
  }

  function gateByGender(gender){
    const g = (gender === "female") ? "female" : (gender === "male" ? "male" : "");
    if (!g) { if (prompt) prompt.style.display = ""; grid.style.display = "none"; }
    else { if (prompt) prompt.style.display = "none"; grid.style.display = ""; }
    cards.forEach(card => { card.classList.toggle("isHidden", g ? (card.dataset.gender !== g) : true); });
    const selected = cards.find(c => c.classList.contains("isSelected"));
    if (selected && g && selected.dataset.gender !== g) clearSelection();
  }

  cards.forEach(card => {
    card.addEventListener("click", () => setSelection(card));
    card.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); setSelection(card); } });
  });

  window.__gateBfCardsByGender = gateByGender;
  const genderSel = document.getElementById("gender");
  gateByGender(genderSel ? genderSel.value : "");
}

/* =========================
   WIZARD
   ========================= */
const stepsEls = Array.from(document.querySelectorAll(".step"));
const stepper = document.getElementById("stepper");
const backBtn = document.getElementById("backBtn");
const nextBtn = document.getElementById("nextBtn");
const form = document.getElementById("quizForm");
let currentStep = 0;
let lastResultsData = null;

function renderStepper() {
  stepper.innerHTML = "";
  for (let i=0;i<stepsEls.length;i++){
    const d = document.createElement("div");
    d.className = "dot" + (i===currentStep ? " on" : "");
    stepper.appendChild(d);
  }
}

function showStep(i){
  stepsEls.forEach((s, idx)=> s.style.display = idx===i ? "" : "none");
  currentStep = i;
  renderStepper();
  backBtn.disabled = (i===0);
  updateNavButtonText();
  showErrorBanner([]);
  const badges = document.getElementById("heroBadges");
  if (badges) badges.style.display = (i === 0) ? "" : "none";
  const stepEl = document.getElementById(`step-${i}`);
  if (stepEl) stepEl.scrollIntoView({ behavior: "smooth", block: "start" });
  if (i > 0 && i < stepsEls.length - 1) trackToGoogleSheets('in_progress', i);
}

function getFormData(){
  const fd = new FormData(form);
  const allergies = fd.getAll("allergies");
  const data = Object.fromEntries(fd.entries());
  data.allergies = allergies;
  data.age = Number(data.age);
  data.heightCm = Number(data.heightCm);
  data.weightKg = Number(data.weightKg);
  data.bfMin = Number(data.bfMin);
  data.bfMax = Number(data.bfMax);
  data.bfRangeLabel = String(data.bfRangeLabel || "");
  if (data.trainingNow === "no") data.sessionsPerWeek = "0";
  return data;
}

backBtn.addEventListener("click", ()=>{ if (currentStep>0) showStep(currentStep-1); });

nextBtn.addEventListener("click", ()=>{
  if (currentStep === stepsEls.length-1) {
    sessionId = generateSessionId();
    sessionStorage.setItem('quiz_session_id', sessionId);
    ctaClicks = { calendly: false, skool: false, sendEmail: false, sendWhatsApp: false, sendResultsChecked: false };
    userContactInfo = { email: '', phone: '' };
    form.reset();
    document.getElementById("results").innerHTML = "";
    const cards = document.querySelectorAll(".bfCard");
    cards.forEach(c => { c.classList.remove("isSelected"); c.setAttribute("aria-checked", "false"); });
    document.getElementById("bfMin").value = "";
    document.getElementById("bfMax").value = "";
    document.getElementById("bfRangeLabel").value = "";
    if (window.__gateBfCardsByGender) window.__gateBfCardsByGender("");
    updateTrainingFields();
    updateProduceAllergyField();
    updateCurrentCalsRequired();
    showStep(0);
    trackToGoogleSheets('started', 0);
    return;
  }
  if (currentStep < stepsEls.length-2) {
    if (!validateStep(currentStep)) return;
    showStep(currentStep+1);
    return;
  }
  if (!validateStep(currentStep)) return;
  const data = getFormData();
  lastResultsData = data;
  renderResults(data);
  showStep(currentStep+1);
});

/* dynamic field events */
document.getElementById("trainingNow").addEventListener("change", ()=>{
  document.getElementById("trainedBefore").value = "";
  document.getElementById("trainingType").value = "";
  document.getElementById("trainingDetails").value = "";
  updateTrainingFields();
});
document.getElementById("trainedBefore").addEventListener("change", ()=>{
  document.getElementById("trainingType").value = "";
  document.getElementById("trainingDetails").value = "";
  updateTrainingFields();
});
document.getElementById("trainingType").addEventListener("change", ()=>{
  document.getElementById("trainingDetails").value = "";
  updateTrainingFields();
});
document.querySelectorAll('input[name="allergies"]').forEach(cb=>{ cb.addEventListener("change", updateProduceAllergyField); });
document.getElementById("tracks").addEventListener("change", updateCurrentCalsRequired);
document.getElementById("gender").addEventListener("change", (e) => {
  if (window.__gateBfCardsByGender) window.__gateBfCardsByGender(e.target.value);
});

/* init */
updateTrainingFields();
updateProduceAllergyField();
updateCurrentCalsRequired();
initBfVisualCards();
renderStepper();
showStep(0);

const langSelect = document.getElementById("langSelect");
if (langSelect){
  langSelect.value = getLang();
  langSelect.addEventListener("change", (e)=> setLang(e.target.value));
}
applyI18n();
updateNavButtonText();

</script>
</body>
</html>
